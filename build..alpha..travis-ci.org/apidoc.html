<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

    >neocrawler (v2.0.2)</a>
</h1>
<h4>Nodejs Distribute Crawler</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler">module neocrawler</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.call">
            function <span class="apidocSignatureSpan">neocrawler.</span>call
            <span class="apidocSignatureSpan">(responseClass, header, timeout, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader">
            function <span class="apidocSignatureSpan">neocrawler.</span>downloader
            <span class="apidocSignatureSpan">(spiderCore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor">
            function <span class="apidocSignatureSpan">neocrawler.</span>extractor
            <span class="apidocSignatureSpan">(spiderCore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.filter_list">
            function <span class="apidocSignatureSpan">neocrawler.</span>filter_list
            <span class="apidocSignatureSpan">(operator, filter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.get">
            function <span class="apidocSignatureSpan">neocrawler.</span>get
            <span class="apidocSignatureSpan">(row)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy">
            function <span class="apidocSignatureSpan">neocrawler.</span>gfw_proxy
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index">
            function <span class="apidocSignatureSpan">neocrawler.</span>index
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider">
            function <span class="apidocSignatureSpan">neocrawler.</span>spider
            <span class="apidocSignatureSpan">(spiderCore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.webconfig">
            function <span class="apidocSignatureSpan">neocrawler.</span>webconfig
            <span class="apidocSignatureSpan">(webconfigCore)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>SSDB</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>call.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>downloader.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>extractor.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>filter_list.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>gbk</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>get.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>gfw_proxy.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>httpRequest</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>index.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>line_reader</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>logging</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>myredis</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>qqwry</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>routecontroller</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>scan</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>spider.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>ssdb_redis</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>utils</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">neocrawler.</span>webconfig.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.SSDB">module neocrawler.SSDB</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.SSDB.connect">
            function <span class="apidocSignatureSpan">neocrawler.SSDB.</span>connect
            <span class="apidocSignatureSpan">(host, port, timeout, listener)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.call">module neocrawler.call</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.call.call">
            function <span class="apidocSignatureSpan">neocrawler.</span>call
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.call.prototype">module neocrawler.call.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.call.prototype.complete">
            function <span class="apidocSignatureSpan">neocrawler.call.prototype.</span>complete
            <span class="apidocSignatureSpan">(err, data)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.downloader">module neocrawler.downloader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.downloader">
            function <span class="apidocSignatureSpan">neocrawler.</span>downloader
            <span class="apidocSignatureSpan">(spiderCore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.super_">
            function <span class="apidocSignatureSpan">neocrawler.downloader.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.downloader.prototype">module neocrawler.downloader.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.assembly">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>assembly
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.browseIt">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>browseIt
            <span class="apidocSignatureSpan">(urlinfo)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.download">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>download
            <span class="apidocSignatureSpan">(urlinfo)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.downloadIt">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>downloadIt
            <span class="apidocSignatureSpan">(urlinfo)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.downloadItAct">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>downloadItAct
            <span class="apidocSignatureSpan">(urlinfo)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.getProxyListFromDb">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>getProxyListFromDb
            <span class="apidocSignatureSpan">(label)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.get_page_encoding">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>get_page_encoding
            <span class="apidocSignatureSpan">(header)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.refreshProxyList">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>refreshProxyList
            <span class="apidocSignatureSpan">(downloader)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.downloader.prototype.transCookieKvPair">
            function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>transCookieKvPair
            <span class="apidocSignatureSpan">(json)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.extractor">module neocrawler.extractor</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.extractor">
            function <span class="apidocSignatureSpan">neocrawler.</span>extractor
            <span class="apidocSignatureSpan">(spiderCore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.extractor.prototype">module neocrawler.extractor.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.__getTopLevelDomain">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>__getTopLevelDomain
            <span class="apidocSignatureSpan">(domain)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.arrange_link">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>arrange_link
            <span class="apidocSignatureSpan">(links)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.assembly">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>assembly
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.checksublack">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>checksublack
            <span class="apidocSignatureSpan">(keys, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.cssSelector">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>cssSelector
            <span class="apidocSignatureSpan">($, expression, pick, index)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.cssSelectorPicker">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>cssSelectorPicker
            <span class="apidocSignatureSpan">(val, pick)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.detectLink">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>detectLink
            <span class="apidocSignatureSpan">(link)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.extract">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>extract
            <span class="apidocSignatureSpan">(crawl_info)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.extract_data">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>extract_data
            <span class="apidocSignatureSpan">(url, content, extract_rule, uppper_data, dom)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.extract_link">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>extract_link
            <span class="apidocSignatureSpan">($, rules)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.getDrillRelation">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>getDrillRelation
            <span class="apidocSignatureSpan">($, crawl_info)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.regexSelector">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>regexSelector
            <span class="apidocSignatureSpan">(content, expression, index)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.validateContent">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>validateContent
            <span class="apidocSignatureSpan">(crawl_info)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.extractor.prototype.wash_link">
            function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>wash_link
            <span class="apidocSignatureSpan">(pageurl, links)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.filter_list">module neocrawler.filter_list</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.filter_list.filter_list">
            function <span class="apidocSignatureSpan">neocrawler.</span>filter_list
            <span class="apidocSignatureSpan">(operator, filter)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.filter_list.prototype">module neocrawler.filter_list.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.filter_list.prototype.addFilter">
            function <span class="apidocSignatureSpan">neocrawler.filter_list.prototype.</span>addFilter
            <span class="apidocSignatureSpan">(filter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.filter_list.prototype.get">
            function <span class="apidocSignatureSpan">neocrawler.filter_list.prototype.</span>get
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.gbk">module neocrawler.gbk</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gbk.dc_GBK">
            function <span class="apidocSignatureSpan">neocrawler.gbk.</span>dc_GBK
            <span class="apidocSignatureSpan">(arr)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.get">module neocrawler.get</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.get.get">
            function <span class="apidocSignatureSpan">neocrawler.</span>get
            <span class="apidocSignatureSpan">(row)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.get.prototype">module neocrawler.get.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.get.prototype.addColumn">
            function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>addColumn
            <span class="apidocSignatureSpan">(cf, qualifier)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.get.prototype.getFields">
            function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>getFields
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.get.prototype.getRow">
            function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>getRow
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.get.prototype.setMaxVersions">
            function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>setMaxVersions
            <span class="apidocSignatureSpan">(maxVersions)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.get.prototype.setTimeRange">
            function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>setTimeRange
            <span class="apidocSignatureSpan">(minStamp, maxStamp)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.gfw_proxy">module neocrawler.gfw_proxy</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.gfw_proxy">
            function <span class="apidocSignatureSpan">neocrawler.</span>gfw_proxy
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.super_">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.gfw_proxy.prototype">module neocrawler.gfw_proxy.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.__chooseProxy">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__chooseProxy
            <span class="apidocSignatureSpan">(domain, ip, header, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.__getProxyFromDb">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__getProxyFromDb
            <span class="apidocSignatureSpan">(domain, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.__getTopLevelDomain">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__getTopLevelDomain
            <span class="apidocSignatureSpan">(domain)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.__voteProxy">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__voteProxy
            <span class="apidocSignatureSpan">(domain, ip, score, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.ipInChina">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>ipInChina
            <span class="apidocSignatureSpan">(ip)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.needProxy">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>needProxy
            <span class="apidocSignatureSpan">(hostname, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.proxyDaemon">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>proxyDaemon
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.gfw_proxy.prototype.start">
            function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.httpRequest">module neocrawler.httpRequest</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.httpRequest.cssExtract">
            function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>cssExtract
            <span class="apidocSignatureSpan">(content, expression, pick, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.httpRequest.getDom">
            function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>getDom
            <span class="apidocSignatureSpan">(content)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.httpRequest.regexExtract">
            function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>regexExtract
            <span class="apidocSignatureSpan">(content, expression, index)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.httpRequest.request">
            function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>request
            <span class="apidocSignatureSpan">(url, referer, cookie, proxy, timeout, isbin, callback, param)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.index">module neocrawler.index</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.index">
            function <span class="apidocSignatureSpan">neocrawler.</span>index
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.super_">
            function <span class="apidocSignatureSpan">neocrawler.index.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.index.prototype">module neocrawler.index.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.prototype.__chooseProxy">
            function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__chooseProxy
            <span class="apidocSignatureSpan">(domain, ip, header, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.prototype.__getProxyFromDb">
            function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__getProxyFromDb
            <span class="apidocSignatureSpan">(domain, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.prototype.__getTopLevelDomain">
            function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__getTopLevelDomain
            <span class="apidocSignatureSpan">(domain)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.prototype.__voteProxy">
            function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__voteProxy
            <span class="apidocSignatureSpan">(domain, ip, score, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.prototype.proxyDaemon">
            function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>proxyDaemon
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.index.prototype.start">
            function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.line_reader">module neocrawler.line_reader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.line_reader.eachLine">
            function <span class="apidocSignatureSpan">neocrawler.line_reader.</span>eachLine
            <span class="apidocSignatureSpan">(filename, cb, separator, encoding, bufferSize)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.line_reader.open">
            function <span class="apidocSignatureSpan">neocrawler.line_reader.</span>open
            <span class="apidocSignatureSpan">(filename, cb, separator, encoding, bufferSize)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.logging">module neocrawler.logging</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.logging.getLogger">
            function <span class="apidocSignatureSpan">neocrawler.logging.</span>getLogger
            <span class="apidocSignatureSpan">(name, instance, level)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.myredis">module neocrawler.myredis</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.myredis.createClient">
            function <span class="apidocSignatureSpan">neocrawler.myredis.</span>createClient
            <span class="apidocSignatureSpan">(host, port, db, type, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.qqwry">module neocrawler.qqwry</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.DBUG">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>DBUG
            <span class="apidocSignatureSpan">(a)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.info">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>info
            <span class="apidocSignatureSpan">(dataPath)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.infoAsync">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>infoAsync
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.intToIP">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>intToIP
            <span class="apidocSignatureSpan">(INT)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.ipEndianChange">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>ipEndianChange
            <span class="apidocSignatureSpan">(INT)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.ipToInt">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>ipToInt
            <span class="apidocSignatureSpan">(IP)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.searchIP">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>searchIP
            <span class="apidocSignatureSpan">(IP)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.searchIPScope">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>searchIPScope
            <span class="apidocSignatureSpan">(bginIP, endIP, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.qqwry.searchIPScopeAsync">
            function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>searchIPScopeAsync
            <span class="apidocSignatureSpan">(a, b, c)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.routecontroller">module neocrawler.routecontroller</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.routecontroller.mapRoute">
            function <span class="apidocSignatureSpan">neocrawler.routecontroller.</span>mapRoute
            <span class="apidocSignatureSpan">(app)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.scan">module neocrawler.scan</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.scan.Scan">
            function <span class="apidocSignatureSpan">neocrawler.scan.</span>Scan
            <span class="apidocSignatureSpan">(table, startRow, stopRow, client)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.scan.getFilter">
            function <span class="apidocSignatureSpan">neocrawler.scan.</span>getFilter
            <span class="apidocSignatureSpan">(filter)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.spider">module neocrawler.spider</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.spider">
            function <span class="apidocSignatureSpan">neocrawler.</span>spider
            <span class="apidocSignatureSpan">(spiderCore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.spider.prototype">module neocrawler.spider.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.__getTopLevelDomain">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>__getTopLevelDomain
            <span class="apidocSignatureSpan">(domain)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.assembly">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>assembly
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.checkQueue">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>checkQueue
            <span class="apidocSignatureSpan">(spider)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.detectLink">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>detectLink
            <span class="apidocSignatureSpan">(link)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.getDrillerRule">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>getDrillerRule
            <span class="apidocSignatureSpan">(id, name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.getDrillerRules">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>getDrillerRules
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.getUrlQueue">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>getUrlQueue
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.jsonSmartDeepParse">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>jsonSmartDeepParse
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.refreshDrillerRules">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>refreshDrillerRules
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.retryCrawl">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>retryCrawl
            <span class="apidocSignatureSpan">(urlinfo)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.updateLinkState">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>updateLinkState
            <span class="apidocSignatureSpan">(link, state, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.wrapLink">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>wrapLink
            <span class="apidocSignatureSpan">(link)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.spider.prototype.wrapper_rules">
            function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>wrapper_rules
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.ssdb_redis">module neocrawler.ssdb_redis</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.ssdb_redis.client">
            function <span class="apidocSignatureSpan">neocrawler.ssdb_redis.</span>client
            <span class="apidocSignatureSpan">(host, port)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.utils">module neocrawler.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.utils.bufferCompare">
            function <span class="apidocSignatureSpan">neocrawler.utils.</span>bufferCompare
            <span class="apidocSignatureSpan">(a, b)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.utils.bufferIncrement">
            function <span class="apidocSignatureSpan">neocrawler.utils.</span>bufferIncrement
            <span class="apidocSignatureSpan">(buffer, i)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.webconfig">module neocrawler.webconfig</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.webconfig.webconfig">
            function <span class="apidocSignatureSpan">neocrawler.</span>webconfig
            <span class="apidocSignatureSpan">(webconfigCore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.neocrawler.webconfig.prototype">module neocrawler.webconfig.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.neocrawler.webconfig.prototype.launch">
            function <span class="apidocSignatureSpan">neocrawler.webconfig.prototype.</span>launch
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler" id="apidoc.module.neocrawler">module neocrawler</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.call" id="apidoc.element.neocrawler.call">
        function <span class="apidocSignatureSpan">neocrawler.</span>call
        <span class="apidocSignatureSpan">(responseClass, header, timeout, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Call(responseClass, header, timeout, cb) {
  this.responseClass = responseClass;
  this.header = header;
  this.timeout = timeout;
  this.cb = cb;
  this.complete = __bind(this.complete, this);
  this.called = false;
  this.startTime = new Date;
  this.timer = setTimeout((function(_this) {
    return function() {
      debug(&#x22;operation &#x22; + _this.header.callId + &#x22; (&#x22; + _this.header.methodName + &#x22;) timedout after &#x22; + _this.timeout + &#x22;ms&#x22;);
      _this.called = true;
      return _this.cb(&#x27;timedout&#x27;);
    };
  })(this), this.timeout);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var myredis = require(&#x27;../lib/myredis.js&#x27;);
require(&#x27;../lib/jsextend.js&#x27;);
var logger;
var PROXY_KEYS = &#x27;proxy:public:available:3s&#x27;;

/////////////////////////////////////////////////////////////////
var proxyRouter = function(settings){
	events.EventEmitter.<span class="apidocCodeKeywordSpan">call</span>(this);//eventemitter inherits
	this.settings = settings;
	logger = settings[&#x27;logger&#x27;];
    this.handleCount = 0;//proxy handle count. once proxy list change, reset to 0.
    this.proxyServeMap = {};
    this.availableProxies = {};/*{domain:{$IP$:true}}*/
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader" id="apidoc.element.neocrawler.downloader">
        function <span class="apidocSignatureSpan">neocrawler.</span>downloader
        <span class="apidocSignatureSpan">(spiderCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">downloader = function (spiderCore){
    events.EventEmitter.call(this);//eventemitter inherits
    this.spiderCore = spiderCore;
    this.proxyList = [];
    this.timeout_count = 0;
    logger = spiderCore.settings.logger;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor" id="apidoc.element.neocrawler.extractor">
        function <span class="apidocSignatureSpan">neocrawler.</span>extractor
        <span class="apidocSignatureSpan">(spiderCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">extractor = function (spiderCore){
    this.spiderCore = spiderCore;
    logger = spiderCore.settings.logger;
    this.cumulative_failure = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.filter_list" id="apidoc.element.neocrawler.filter_list">
        function <span class="apidocSignatureSpan">neocrawler.</span>filter_list
        <span class="apidocSignatureSpan">(operator, filter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FilterList(operator, filter) {
  var _ref;
  this.operator = operator;
  this.get = __bind(this.get, this);
  this.addFilter = __bind(this.addFilter, this);
  if ((_ref = this.operator) !== &#x27;MUST_PASS_ALL&#x27; &#x26;&#x26; _ref !== &#x27;MUST_PASS_ONE&#x27;) {
    this.operator = &#x27;MUST_PASS_ALL&#x27;;
  }
  this.filters = [];
  if (filter) {
    filter = getFilter(filter);
    if (!filter) {
      return false;
    }
    this.filters.push(filter);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.get" id="apidoc.element.neocrawler.get">
        function <span class="apidocSignatureSpan">neocrawler.</span>get
        <span class="apidocSignatureSpan">(row)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Get(row) {
  this.row = row;
  this.getRow = __bind(this.getRow, this);
  this.getFields = __bind(this.getFields, this);
  this.setTimeRange = __bind(this.setTimeRange, this);
  this.setMaxVersions = __bind(this.setMaxVersions, this);
  this.addColumn = __bind(this.addColumn, this);
  this.tr = {
    from: null,
    to: null
  };
  this.familyMap = {};
  this.maxVersions = 1;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var redis_cli = function(host,port){
    this.ssdb_cli = SSDB.connect(host, port,30*1000,function(err,errobj){
        if(err)throw errobj;
    });
}

redis_cli.prototype.get = function(key,callback){
    this.ssdb_cli.<span class="apidocCodeKeywordSpan">get</span>(key,callback);
}

redis_cli.prototype.set = function(key,value,callback){
    this.ssdb_cli.set(key,value,callback);
}

redis_cli.prototype.expire = function(key,sec,callback){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy" id="apidoc.element.neocrawler.gfw_proxy">
        function <span class="apidocSignatureSpan">neocrawler.</span>gfw_proxy
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">gfw_proxy = function (settings){
	events.EventEmitter.call(this);//eventemitter inherits
	this.settings = settings;
	logger = settings[&#x27;logger&#x27;];
    this.handleCount = 0;//proxy handle count. once proxy list change, reset to 0.
    this.proxyServeMap = {};
    this.availableProxies = {};/*{domain:{$IP$:true}}*/
    this.resolvCache = {
        &#x27;192.168.72.11&#x27;:false,
        &#x27;192.168.72.29&#x27;:false,
        &#x27;192.168.72.34&#x27;:false
    };
    this.dnsCache = {
        &#x27;backee&#x27;:&#x27;10.1.1.122&#x27;
    };
    qqwry.info();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.index" id="apidoc.element.neocrawler.index">
        function <span class="apidocSignatureSpan">neocrawler.</span>index
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">index = function (settings){
	events.EventEmitter.call(this);//eventemitter inherits
	this.settings = settings;
	logger = settings[&#x27;logger&#x27;];
    this.handleCount = 0;//proxy handle count. once proxy list change, reset to 0.
    this.proxyServeMap = {};
    this.availableProxies = {};/*{domain:{$IP$:true}}*/
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider" id="apidoc.element.neocrawler.spider">
        function <span class="apidocSignatureSpan">neocrawler.</span>spider
        <span class="apidocSignatureSpan">(spiderCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">spider = function (spiderCore){
    this.spiderCore = spiderCore;
    this.queue_length = 0;
    this.driller_rules_updated = 0;
    this.driller_rules = {};
    logger = spiderCore.settings.logger;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.webconfig" id="apidoc.element.neocrawler.webconfig">
        function <span class="apidocSignatureSpan">neocrawler.</span>webconfig
        <span class="apidocSignatureSpan">(webconfigCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">webconfig = function (webconfigCore){
	events.EventEmitter.call(this);
	this.webconfigCore = webconfigCore;
	logger = webconfigCore.settings.logger;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.SSDB" id="apidoc.module.neocrawler.SSDB">module neocrawler.SSDB</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.SSDB.connect" id="apidoc.element.neocrawler.SSDB.connect">
        function <span class="apidocSignatureSpan">neocrawler.SSDB.</span>connect
        <span class="apidocSignatureSpan">(host, port, timeout, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (host, port, timeout, listener){
    return new SSDBConnect(host, port, timeout, listener);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if(!connected){
        listener(&#x27;connect_failed&#x27;, e);
    }else{
        var callback = callbacks.shift();
        if(callback)callback([&#x27;error&#x27;]);
    }
});
sock.<span class="apidocCodeKeywordSpan">connect</span>(port, host, function(){
    connected = true;
    sock.setNoDelay(true);
    sock.setKeepAlive(true);
    sock.setTimeout(timeout);
    listener(0, self);
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.call" id="apidoc.module.neocrawler.call">module neocrawler.call</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.call.call" id="apidoc.element.neocrawler.call.call">
        function <span class="apidocSignatureSpan">neocrawler.</span>call
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function call() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var myredis = require(&#x27;../lib/myredis.js&#x27;);
require(&#x27;../lib/jsextend.js&#x27;);
var logger;
var PROXY_KEYS = &#x27;proxy:public:available:3s&#x27;;

/////////////////////////////////////////////////////////////////
var proxyRouter = function(settings){
	events.EventEmitter.<span class="apidocCodeKeywordSpan">call</span>(this);//eventemitter inherits
	this.settings = settings;
	logger = settings[&#x27;logger&#x27;];
    this.handleCount = 0;//proxy handle count. once proxy list change, reset to 0.
    this.proxyServeMap = {};
    this.availableProxies = {};/*{domain:{$IP$:true}}*/
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.call.prototype" id="apidoc.module.neocrawler.call.prototype">module neocrawler.call.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.call.prototype.complete" id="apidoc.element.neocrawler.call.prototype.complete">
        function <span class="apidocSignatureSpan">neocrawler.call.prototype.</span>complete
        <span class="apidocSignatureSpan">(err, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">complete = function (err, data) {
  if (this.called) {
    return;
  }
  debug(&#x22;operation &#x22; + this.header.callId + &#x22; (&#x22; + this.header.methodName + &#x22;) completed. Took: &#x22; + (new Date - this.startTime) + &#x22;
ms&#x22;);
  clearTimeout(this.timer);
  return this.cb(err, data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.downloader" id="apidoc.module.neocrawler.downloader">module neocrawler.downloader</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.downloader.downloader" id="apidoc.element.neocrawler.downloader.downloader">
        function <span class="apidocSignatureSpan">neocrawler.</span>downloader
        <span class="apidocSignatureSpan">(spiderCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">downloader = function (spiderCore){
    events.EventEmitter.call(this);//eventemitter inherits
    this.spiderCore = spiderCore;
    this.proxyList = [];
    this.timeout_count = 0;
    logger = spiderCore.settings.logger;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.super_" id="apidoc.element.neocrawler.downloader.super_">
        function <span class="apidocSignatureSpan">neocrawler.downloader.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.downloader.prototype" id="apidoc.module.neocrawler.downloader.prototype">module neocrawler.downloader.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.assembly" id="apidoc.element.neocrawler.downloader.prototype.assembly">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>assembly
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">assembly = function (callback){
    /*
    var downloader = this;
    var MIN_PROXY_LENGTH = 1000;
    downloader.on(&#x27;gotProxyList&#x27;,function(label,proxylist){
        if(proxylist&#x26;&#x26;proxylist.length&#x3e;0)downloader.tmp_proxyList = downloader.tmp_proxyList.concat(proxylist);
        switch(label){
            case &#x27;proxy:vip:available:1s&#x27;:
                if(downloader.tmp_proxyList.length&#x3c;MIN_PROXY_LENGTH)this.getProxyListFromDb(&#x27;proxy:vip:available:3s&#x27;);
                else {
                    downloader.proxyList = downloader.tmp_proxyList;
                    downloader.emit(&#x27;refreshed_proxy_list&#x27;,downloader.proxyList);
                }
                break;
            case &#x27;proxy:vip:available:3s&#x27;:
                if(downloader.tmp_proxyList.length&#x3c;MIN_PROXY_LENGTH)this.getProxyListFromDb(&#x27;proxy:public:available:1s&#x27;);
                else {
                    downloader.proxyList = downloader.tmp_proxyList;
                    downloader.emit(&#x27;refreshed_proxy_list&#x27;,downloader.proxyList);
                }
                break;
            case &#x27;proxy:public:available:1s&#x27;:
                if(downloader.tmp_proxyList.length&#x3c;MIN_PROXY_LENGTH)this.getProxyListFromDb(&#x27;proxy:public:available:3s&#x27;);
                else {
                    downloader.proxyList = downloader.tmp_proxyList;
                    downloader.emit(&#x27;refreshed_proxy_list&#x27;,downloader.proxyList);
                }
                break;
            case &#x27;proxy:public:available:3s&#x27;:
                if(downloader.tmp_proxyList.length&#x3c;MIN_PROXY_LENGTH)logger.warn(util.format(&#x27;Only %d proxies !!!&#x27;,downloader.tmp_proxyList
.length));
                if(downloader.tmp_proxyList.length&#x3c;0)throw new Error(&#x27;no proxy list&#x27;);
                else{
                    downloader.proxyList = downloader.tmp_proxyList;
                    downloader.emit(&#x27;refreshed_proxy_list&#x27;,downloader.proxyList);
                }
                break;
        }
    });
    this.redis_cli3 = redis.createClient(this.spiderCore.settings[&#x27;proxy_info_redis_db&#x27;][1],this.spiderCore.settings[&#x27;proxy_info_redis_db
&#x27;][0]);
    if(this.spiderCore.settings[&#x27;use_proxy&#x27;]){
        downloader.redis_cli3.select(downloader.spiderCore.settings[&#x27;proxy_info_redis_db&#x27;][2], function(err,value) {
             if(err)throw(err);
             downloader.refreshProxyList(downloader);
             downloader.on(&#x27;refreshed_proxy_list&#x27;,function(proxylist){
                 downloader.spiderCore.emit(&#x27;standby&#x27;,&#x27;downloader&#x27;);
                 setTimeout(function(){downloader.refreshProxyList(downloader)},10*60*1000);//refresh again after 10 mins
             });
         });

    }else{
        this.spiderCore.emit(&#x27;standby&#x27;,&#x27;downloader&#x27;);
    }
    */
    if(callback)callback(null,&#x27;done&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.browseIt" id="apidoc.element.neocrawler.downloader.prototype.browseIt">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>browseIt
        <span class="apidocSignatureSpan">(urlinfo)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">browseIt = function (urlinfo){
    var spiderCore = this.spiderCore;
    if(this.spiderCore.settings[&#x27;test&#x27;]){
        urlinfo[&#x27;test&#x27;] = true;
        urlinfo[&#x27;ipath&#x27;] = path.join(__dirname,&#x27;..&#x27;, &#x27;instance&#x27;,this.spiderCore.settings[&#x27;instance&#x27;],&#x27;logs&#x27;);
    }
    var useProxy = false;
    if(urlinfo[&#x27;urllib&#x27;]&#x26;&#x26;spiderCore.settings[&#x27;use_proxy&#x27;]===true){
        if(spiderCore.spider.getDrillerRule(urlinfo[&#x27;urllib&#x27;],&#x27;use_proxy&#x27;)===true)useProxy=true;
    }
    if(useProxy){
        var phantomjs = child_process.spawn(&#x27;./phantomjs&#x27;, [
            &#x27;--proxy&#x27;, this.spiderCore.settings[&#x27;proxy_router&#x27;],
            &#x27;--load-images&#x27;, &#x27;false&#x27;,
            &#x27;--local-to-remote-url-access&#x27;,&#x27;true&#x27;,
            //&#x27;--cookies-file&#x27;,path.join(__dirname,&#x27;..&#x27;, &#x27;instance&#x27;,this.spiderCore.settings[&#x27;instance&#x27;],&#x27;logs&#x27;,&#x27;cookies.log&#x27;),
            &#x27;phantomjs-bridge.js&#x27;,
            JSON.stringify(urlinfo)],
            {&#x27;cwd&#x27;:path.join(__dirname,&#x27;..&#x27;, &#x27;lib&#x27;,&#x27;phantomjs&#x27;),
                &#x27;stdio&#x27;:&#x27;pipe&#x27;}
        );
    }else{
        var phantomjs = child_process.spawn(&#x27;./phantomjs&#x27;, [
            &#x27;--load-images&#x27;, &#x27;false&#x27;,
            &#x27;--local-to-remote-url-access&#x27;,&#x27;true&#x27;,
            //&#x27;--cookies-file&#x27;,path.join(__dirname,&#x27;..&#x27;, &#x27;instance&#x27;,this.spiderCore.settings[&#x27;instance&#x27;],&#x27;logs&#x27;,&#x27;cookies.log&#x27;),
            &#x27;phantomjs-bridge.js&#x27;,
            JSON.stringify(urlinfo)],
            {&#x27;cwd&#x27;:path.join(__dirname,&#x27;..&#x27;, &#x27;lib&#x27;,&#x27;phantomjs&#x27;),
                &#x27;stdio&#x27;:&#x27;pipe&#x27;}
        );
    }

    phantomjs.stdin.setEncoding(&#x27;utf8&#x27;);
    phantomjs.stdout.setEncoding(&#x27;utf8&#x27;);

    phantomjs.on(&#x27;error&#x27;,function(err){logger.error(err);});

    var feedback = &#x27;&#x27;;
    phantomjs.stdout.on(&#x27;data&#x27;, function(data) {
        data = data.trim();
        if(feedback==&#x27;&#x27;&#x26;&#x26;!data.startsWith(&#x27;{&#x27;)){
            logger.warn(&#x27;phantomjs: &#x27;+data);
        }else{
            feedback += data;
            if(data.endsWith(&#x27;}#^_^#&#x27;)){
                var emit_string = feedback.slice(0,-5);
                feedback = &#x27;&#x27;;
                phantomjs.emit(&#x27;feedback&#x27;,emit_string);
            }
        }
    });

    phantomjs.on(&#x27;feedback&#x27;, function(data) {
        try{
            var feedback = JSON.parse(data);//data.toString(&#x27;utf8&#x27;)
        }catch(e){
            logger.error(util.format(&#x27;Page content parse error: %s&#x27;,e));
            spiderCore.emit(&#x27;crawling_break&#x27;,urlinfo,e.message);
            phantomjs.kill();
            return;
        }
        switch(feedback[&#x27;signal&#x27;]){
            case CMD_SIGNAL_CRAWL_SUCCESS:
                spiderCore.emit(&#x27;crawled&#x27;,feedback);
                break;
            case CMD_SIGNAL_CRAWL_FAIL:
                logger.error(feedback.url+&#x27; crawled fail&#x27;);
                phantomjs.kill();
                if(feedback[&#x27;url&#x27;]==urlinfo[&#x27;url&#x27;])spiderCore.emit(&#x27;crawling_failure&#x27;,urlinfo,&#x27;phantomjs crawl failure&#x27;);
                break;
            case CMD_SIGNAL_NAVIGATE_EXCEPTION:
                logger.error(feedback.url+&#x27; navigate fail&#x27;);
                phantomjs.kill();
                break;
            default:
                logger.debug(&#x27;Phantomjs: &#x27;+data);
        }
    });

    phantomjs.stderr.on(&#x27;data&#x27;, function (data) {
        logger.error(data.toString(&#x27;utf8&#x27;));
    });

    phantomjs.on(&#x27;exit&#x27;, function (code) {
        if(code!=0)logger.error(&#x27;child process exited with code &#x27; + code);
    });

    phantomjs.on(&#x27;close&#x27;, function (signal) {
        if(signal!=0)logger.error(&#x27;child process closed with signal &#x27; + signal);
    });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if(err)throw(err);
    downloader.emit(&#x27;gotProxyList&#x27;,label,proxylist);
});
}

////download action/////////////////////
downloader.prototype.download = function (urlinfo){
if(urlinfo[&#x27;jshandle&#x27;])this.<span class="apidocCodeKeywordSpan">browseIt</span>(urlinfo);
else this.downloadIt(urlinfo);
}

downloader.prototype.transCookieKvPair = function(json){
var kvarray = [];
for(var i=0; i&#x3c;json.length; i++){
    kvarray.push(json[i][&#x27;name&#x27;]+&#x27;=&#x27;+json[i][&#x27;value&#x27;]);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.download" id="apidoc.element.neocrawler.downloader.prototype.download">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>download
        <span class="apidocSignatureSpan">(urlinfo)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">download = function (urlinfo){
    if(urlinfo[&#x27;jshandle&#x27;])this.browseIt(urlinfo);
    else this.downloadIt(urlinfo);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * just download html stream
 * @param urlinfo
 */
downloader.prototype.downloadIt = function(urlinfo){
var spiderCore = this.spiderCore;
var self = this;
if(&#x27;download&#x27; in spiderCore.spider_extend){
    spiderCore.spider_extend.<span class="apidocCodeKeywordSpan">download</span>(urlinfo,function(err,result){
        if(err==null&#x26;&#x26;result==null){
            self.downloadItAct(urlinfo);//if all return null, download it use http request
        }else{
            if(err)spiderCore.emit(&#x27;crawling_failure&#x27;,urlinfo,err);
            else spiderCore.emit(&#x27;crawled&#x27;,result);
        }
    });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.downloadIt" id="apidoc.element.neocrawler.downloader.prototype.downloadIt">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>downloadIt
        <span class="apidocSignatureSpan">(urlinfo)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">downloadIt = function (urlinfo){
    var spiderCore = this.spiderCore;
    var self = this;
    if(&#x27;download&#x27; in spiderCore.spider_extend){
        spiderCore.spider_extend.download(urlinfo,function(err,result){
            if(err==null&#x26;&#x26;result==null){
                self.downloadItAct(urlinfo);//if all return null, download it use http request
            }else{
                if(err)spiderCore.emit(&#x27;crawling_failure&#x27;,urlinfo,err);
                else spiderCore.emit(&#x27;crawled&#x27;,result);
            }
        });
    }else self.downloadItAct(urlinfo);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    downloader.emit(&#x27;gotProxyList&#x27;,label,proxylist);
});
}

////download action/////////////////////
downloader.prototype.download = function (urlinfo){
if(urlinfo[&#x27;jshandle&#x27;])this.browseIt(urlinfo);
else this.<span class="apidocCodeKeywordSpan">downloadIt</span>(urlinfo);
}

downloader.prototype.transCookieKvPair = function(json){
var kvarray = [];
for(var i=0; i&#x3c;json.length; i++){
    kvarray.push(json[i][&#x27;name&#x27;]+&#x27;=&#x27;+json[i][&#x27;value&#x27;]);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.downloadItAct" id="apidoc.element.neocrawler.downloader.prototype.downloadItAct">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>downloadItAct
        <span class="apidocSignatureSpan">(urlinfo)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">downloadItAct = function (urlinfo){
    var spiderCore = this.spiderCore;
    var self = this;

    var timeOuter = false;
    var pageLink = urlinfo[&#x27;url&#x27;];
    if(urlinfo[&#x27;redirect&#x27;])pageLink = urlinfo[&#x27;redirect&#x27;];

    var useProxy = false;
    if(urlinfo[&#x27;urllib&#x27;]&#x26;&#x26;spiderCore.settings[&#x27;use_proxy&#x27;]===true){
        if(spiderCore.spider.getDrillerRule(urlinfo[&#x27;urllib&#x27;],&#x27;use_proxy&#x27;)===true)useProxy=true;
    }

    if(useProxy){
        var proxyRouter = spiderCore.settings[&#x27;proxy_router&#x27;].split(&#x27;:&#x27;);
        var __host = proxyRouter[0];
        var __port = proxyRouter[1];
        var __path =  pageLink;
    }else{
        var urlobj = urlUtil.parse(pageLink);
        var __host = urlobj[&#x27;hostname&#x27;];
        var __port = urlobj[&#x27;port&#x27;];
        var __path = urlobj[&#x27;path&#x27;];
//        var __path = pageLink;
    }


    var startTime = new Date();
    var options = {
        &#x27;host&#x27;: __host,
        &#x27;port&#x27;: __port,
        &#x27;path&#x27;: __path,
        &#x27;method&#x27;: &#x27;GET&#x27;,
        &#x27;headers&#x27;: {
            &#x22;User-Agent&#x22;:&#x22;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like NeoCrawler) Chrome/31.0.1650.57 Safari
/537.36&#x22;,
            &#x22;Accept&#x22;:&#x22;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#x22;,
            &#x22;Accept-Encoding&#x22;:&#x22;gzip&#x22;,
            &#x22;Accept-Language&#x22;:&#x22;zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4&#x22;,
            &#x22;Referer&#x22;:urlinfo[&#x27;referer&#x27;]||&#x27;&#x27;,
            &#x22;void-proxy&#x22;:urlinfo[&#x27;void_proxy&#x27;]?urlinfo[&#x27;void_proxy&#x27;]:&#x22;&#x22;,
            &#x22;Cookie&#x22;:this.transCookieKvPair(urlinfo[&#x27;cookie&#x27;])
        }
    };
    logger.debug(util.format(&#x27;Request start, %s&#x27;,pageLink));
    var req = http.request(options, function(res) {
        logger.debug(util.format(&#x27;Response, %s&#x27;,pageLink));

        var result = {
            &#x22;remote_proxy&#x22;:res.headers[&#x27;remoteproxy&#x27;],
            &#x22;drill_count&#x22;:0,
            &#x22;cookie&#x22;:res.headers[&#x27;Cookie&#x27;],
            &#x22;url&#x22;:urlinfo[&#x27;url&#x27;],
            //&#x22;url&#x22;:res.req.path,
            //&#x22;statusCode&#x22;:res.statusCode,
            &#x22;origin&#x22;:urlinfo
        };
        if(result[&#x27;url&#x27;].startsWith(&#x27;/&#x27;))result[&#x27;url&#x27;] = urlUtil.resolve(pageLink,result[&#x27;url&#x27;]);
        result[&#x27;statusCode&#x27;] = res.statusCode;
        if(parseInt(res.statusCode)==301||parseInt(res.statusCode)==302){
            if(res.headers[&#x27;location&#x27;]){
                result[&#x27;origin&#x27;][&#x27;redirect&#x27;] = urlUtil.resolve(pageLink,res.headers[&#x27;location&#x27;]);
                logger.debug(pageLink+&#x27; 301 Moved Permanently to &#x27;+res.headers[&#x27;location&#x27;]);
            }
        }

        var compressed = /gzip|deflate/.test(res.headers[&#x27;content-encoding&#x27;]);

        var bufferHelper = new BufferHelper();
//        res.setEncoding(&#x27;utf8&#x27;);

        res.on(&#x27;data&#x27;, function (chunk) {
            bufferHelper.concat(chunk);
        });

        res.on(&#x27;end&#x27;, function (chunk) {
            self.timeout_count--;
            if(timeOuter){
                clearTimeout(timeOuter);
                timeOuter = false;
            }
            result[&#x22;cost&#x22;] = (new Date()) - startTime;
            logger.debug(&#x27;download &#x27;+pageLink+&#x27;, cost:&#x27;+result[&#x22;cost&#x22;]+&#x27;ms&#x27;);


            var page_encoding = urlinfo[&#x27;encoding&#x27;];

            if(page_encoding===&#x27;auto&#x27;){
                page_encoding = self.get_page_encoding(res.headers);
            }

            page_encoding = page_encoding.toLowerCase().replace(&#x27;\-&#x27;,&#x27;&#x27;)
            if(!compressed || typeof unzip == &#x27;undefined&#x27;){
                if(urlinfo[&#x27;format&#x27;]==&#x27;binary&#x27;){
                    result[&#x22;content&#x22;] = bufferHelper.toBuffer();
                }else{
                    result[&#x22;content&#x22;] = iconv.decode(bufferHelper.toBuffer(),page_encoding);//page_encoding
                }
                spiderCore.emit(&#x27;crawled&#x27;,result);
            }else{
                unzip(bufferHelper.toBuffer(), function(err, buff) {
                    if (!err &#x26;&#x26; buff) {
                        if(urlinfo[&#x27;format&#x27;]==&#x27;binary&#x27;){
                            result[&#x22;content&#x22;] = buff;
                        }else{
                            resu ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
downloader.prototype.downloadIt = function(urlinfo){
    var spiderCore = this.spiderCore;
    var self = this;
    if(&#x27;download&#x27; in spiderCore.spider_extend){
        spiderCore.spider_extend.download(urlinfo,function(err,result){
            if(err==null&#x26;&#x26;result==null){
                self.<span class="apidocCodeKeywordSpan">downloadItAct</span>(urlinfo);//if all return null, download it use http
 request
            }else{
                if(err)spiderCore.emit(&#x27;crawling_failure&#x27;,urlinfo,err);
                else spiderCore.emit(&#x27;crawled&#x27;,result);
            }
        });
    }else self.downloadItAct(urlinfo);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.getProxyListFromDb" id="apidoc.element.neocrawler.downloader.prototype.getProxyListFromDb">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>getProxyListFromDb
        <span class="apidocSignatureSpan">(label)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getProxyListFromDb = function (label){
    var downloader = this;
    logger.debug(util.format(&#x27;get proxy list from :%s&#x27;,label));
    downloader.redis_cli3.lrange(label,0,-1,function(err,proxylist){
        if(err)throw(err);
        downloader.emit(&#x27;gotProxyList&#x27;,label,proxylist);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/*
var downloader = this;
var MIN_PROXY_LENGTH = 1000;
downloader.on(&#x27;gotProxyList&#x27;,function(label,proxylist){
    if(proxylist&#x26;&#x26;proxylist.length&#x3e;0)downloader.tmp_proxyList = downloader.tmp_proxyList.concat(proxylist);
    switch(label){
        case &#x27;proxy:vip:available:1s&#x27;:
            if(downloader.tmp_proxyList.length&#x3c;MIN_PROXY_LENGTH)this.<span class="apidocCodeKeywordSpan">getProxyListFromDb
</span>(&#x27;proxy:vip:available:3s&#x27;);
            else {
                downloader.proxyList = downloader.tmp_proxyList;
                downloader.emit(&#x27;refreshed_proxy_list&#x27;,downloader.proxyList);
            }
            break;
        case &#x27;proxy:vip:available:3s&#x27;:
            if(downloader.tmp_proxyList.length&#x3c;MIN_PROXY_LENGTH)this.getProxyListFromDb(&#x27;proxy:public:available:1s&#x27
;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.get_page_encoding" id="apidoc.element.neocrawler.downloader.prototype.get_page_encoding">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>get_page_encoding
        <span class="apidocSignatureSpan">(header)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get_page_encoding = function (header){
    var page_encoding = &#x27;UTF-8&#x27;;
    //get the encoding from header
    if(header[&#x27;content-type&#x27;]!=undefined){
        var contentType = header[&#x27;content-type&#x27;];
        var patt = new RegExp(&#x22;^.*?charset\=(.+)$&#x22;,&#x22;ig&#x22;);
        var mts = patt.exec(contentType);
        if (mts != null)
        {
            page_encoding = mts[1];
        }
    }
    return page_encoding;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
result[&#x22;cost&#x22;] = (new Date()) - startTime;
logger.debug(&#x27;download &#x27;+pageLink+&#x27;, cost:&#x27;+result[&#x22;cost&#x22;]+&#x27;ms&#x27;);


var page_encoding = urlinfo[&#x27;encoding&#x27;];

if(page_encoding===&#x27;auto&#x27;){
    page_encoding = self.<span class="apidocCodeKeywordSpan">get_page_encoding</span>(res.headers);
}

page_encoding = page_encoding.toLowerCase().replace(&#x27;\-&#x27;,&#x27;&#x27;)
if(!compressed || typeof unzip == &#x27;undefined&#x27;){
    if(urlinfo[&#x27;format&#x27;]==&#x27;binary&#x27;){
        result[&#x22;content&#x22;] = bufferHelper.toBuffer();
    }else{
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.refreshProxyList" id="apidoc.element.neocrawler.downloader.prototype.refreshProxyList">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>refreshProxyList
        <span class="apidocSignatureSpan">(downloader)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">refreshProxyList = function (downloader){
    downloader.tmp_proxyList = [];
    downloader.getProxyListFromDb(&#x27;proxy:vip:available:1s&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            break;
    }
});
this.redis_cli3 = redis.createClient(this.spiderCore.settings[&#x27;proxy_info_redis_db&#x27;][1],this.spiderCore.settings[&#x27
;proxy_info_redis_db&#x27;][0]);
if(this.spiderCore.settings[&#x27;use_proxy&#x27;]){
    downloader.redis_cli3.select(downloader.spiderCore.settings[&#x27;proxy_info_redis_db&#x27;][2], function(err,value) {
         if(err)throw(err);
         downloader.<span class="apidocCodeKeywordSpan">refreshProxyList</span>(downloader);
         downloader.on(&#x27;refreshed_proxy_list&#x27;,function(proxylist){
             downloader.spiderCore.emit(&#x27;standby&#x27;,&#x27;downloader&#x27;);
             setTimeout(function(){downloader.refreshProxyList(downloader)},10*60*1000);//refresh again after 10 mins
         });
     });

}else{
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.downloader.prototype.transCookieKvPair" id="apidoc.element.neocrawler.downloader.prototype.transCookieKvPair">
        function <span class="apidocSignatureSpan">neocrawler.downloader.prototype.</span>transCookieKvPair
        <span class="apidocSignatureSpan">(json)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">transCookieKvPair = function (json){
    var kvarray = [];
    for(var i=0; i&#x3c;json.length; i++){
        kvarray.push(json[i][&#x27;name&#x27;]+&#x27;=&#x27;+json[i][&#x27;value&#x27;]);
    }
    return kvarray.join(&#x27;;&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
&#x27;headers&#x27;: {
    &#x22;User-Agent&#x22;:&#x22;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like NeoCrawler) Chrome/31.0.1650
.57 Safari/537.36&#x22;,
    &#x22;Accept&#x22;:&#x22;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#x22;,
    &#x22;Accept-Encoding&#x22;:&#x22;gzip&#x22;,
    &#x22;Accept-Language&#x22;:&#x22;zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4&#x22;,
    &#x22;Referer&#x22;:urlinfo[&#x27;referer&#x27;]||&#x27;&#x27;,
    &#x22;void-proxy&#x22;:urlinfo[&#x27;void_proxy&#x27;]?urlinfo[&#x27;void_proxy&#x27;]:&#x22;&#x22;,
    &#x22;Cookie&#x22;:this.<span class="apidocCodeKeywordSpan">transCookieKvPair</span>(urlinfo[&#x27;cookie&#x27;])
}
    };
    logger.debug(util.format(&#x27;Request start, %s&#x27;,pageLink));
    var req = http.request(options, function(res) {
logger.debug(util.format(&#x27;Response, %s&#x27;,pageLink));

var result = {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.extractor" id="apidoc.module.neocrawler.extractor">module neocrawler.extractor</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.extractor.extractor" id="apidoc.element.neocrawler.extractor.extractor">
        function <span class="apidocSignatureSpan">neocrawler.</span>extractor
        <span class="apidocSignatureSpan">(spiderCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">extractor = function (spiderCore){
    this.spiderCore = spiderCore;
    logger = spiderCore.settings.logger;
    this.cumulative_failure = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.extractor.prototype" id="apidoc.module.neocrawler.extractor.prototype">module neocrawler.extractor.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.__getTopLevelDomain" id="apidoc.element.neocrawler.extractor.prototype.__getTopLevelDomain">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>__getTopLevelDomain
        <span class="apidocSignatureSpan">(domain)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__getTopLevelDomain = function (domain){
    if(!domain)return null;
    var arr = domain.split(&#x27;.&#x27;);
    if(arr.length&#x3c;=2)return domain;
    else return arr.slice(1).join(&#x27;.&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
proxyRouter.prototype.proxyDaemon = function(){
var proxyRouter = this;
var httpProxyServer = http.createServer(function(request, response) {
    var timeOuter = false;
    var startTime = (new Date()).getTime();
    var urlobj = url.parse(request.url);
    var domain = proxyRouter.<span class="apidocCodeKeywordSpan">__getTopLevelDomain</span>(urlobj[&#x27;hostname&#x27;]);
    logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
    //var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
    //var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
    var route = true;
    proxyRouter.__chooseProxy(domain,request.socket.remoteAddress,request.headers,function(proxyAddr){
        if(route&#x26;&#x26;proxyAddr){
            var choseProxy = proxyAddr.split(&#x27;:&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.arrange_link" id="apidoc.element.neocrawler.extractor.prototype.arrange_link">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>arrange_link
        <span class="apidocSignatureSpan">(links)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">arrange_link = function (links){
    var linkobj = {};
    for(var i=0;i&#x3c;links.length;i++){
        var link = links[i];
        var matched_driller = this.detectLink(link);
        if(matched_driller.length&#x3e;0){
            var driller_lib = &#x27;urllib:&#x27; + matched_driller[0];
            var driller_rule = matched_driller[1];
            if(typeof(driller_rule)!=&#x27;object&#x27;)driller_rule = JSON.parse(driller_rule);
            if(linkobj[driller_lib]==undefined)linkobj[driller_lib]=[];
            if(driller_rule[&#x27;id_parameter&#x27;]&#x26;&#x26;driller_rule[&#x27;id_parameter&#x27;].length&#x3e;0){
                var id_parameter = driller_rule[&#x27;id_parameter&#x27;];
                var urlobj = url.parse(link);
                var parameters = querystring.parse(urlobj.query);
                var new_parameters = {};
                for(var x=0;x&#x3c;id_parameter.length;x++){
                    var param_name = id_parameter[x];
                    if(x==0&#x26;&#x26;param_name==&#x27;#&#x27;)break;
                    if(parameters.hasOwnProperty(param_name))new_parameters[param_name] = parameters[param_name];
                }
                urlobj.search = querystring.stringify(new_parameters);
                link = url.format(urlobj);
            }
            linkobj[driller_lib].push(link);
        }
    }
    for(var i in linkobj){
        if(linkobj.hasOwnProperty(i)){
            linkobj[i] = arrayUnique(linkobj[i]);
        }
    }
    return linkobj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if(crawl_info[&#x27;drill_link&#x27;]){
        var drill_link = crawl_info[&#x27;drill_link&#x27;];
    }else{
        var drill_link = this.extract_link($,crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]);
    }

    var washed_link = this.wash_link(crawl_info[&#x27;url&#x27;],drill_link);
    crawl_info[&#x27;drill_link&#x27;] = this.<span class="apidocCodeKeywordSpan">arrange_link</span>(washed_link);
    if(this.spiderCore.settings[&#x27;keep_link_relation&#x27;])crawl_info[&#x27;drill_relation&#x27;] = this.getDrillRelation($,
crawl_info);
}

if(extract_rule[&#x27;rule&#x27;]&#x26;&#x26;!isEmpty(extract_rule[&#x27;rule&#x27;])){
    var extracted_data = this.extract_data(crawl_info[&#x27;url&#x27;],crawl_info[&#x27;content&#x27;],extract_rule,null,$.root());
    crawl_info[&#x27;extracted_data&#x27;] = extracted_data;
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.assembly" id="apidoc.element.neocrawler.extractor.prototype.assembly">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>assembly
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">assembly = function (callback){
    if(callback)callback(null,&#x27;done&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.checksublack" id="apidoc.element.neocrawler.extractor.prototype.checksublack">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>checksublack
        <span class="apidocSignatureSpan">(keys, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checksublack = function (keys, data){
    var sublackarr = [];
    for(var x=0;x&#x3c;keys.length;x++){
        if(!data[keys[x]]){
            sublackarr.push(keys[x]);
            logger.warn(keys[x] + &#x27; not found in &#x27;+ url + &#x27; extracted data&#x27;);
        }
    }
    if(sublackarr.length===keys.length)return sublackarr;
    else return [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        }
}
if(extract_rule[&#x27;require&#x27;]){
    var lacks = [];
    for(var c=0;c&#x3c;extract_rule[&#x27;require&#x27;].length;c++){
        var key = extract_rule[&#x27;require&#x27;][c];
        if(typeof(key)===&#x27;object&#x27;){
            var sublack = self.<span class="apidocCodeKeywordSpan">checksublack</span>(key,data);
            if(sublack.length&#x3e;0)lacks = lacks.concat(sublack);
        }else{
            if(!data[key]){
                lacks.push(key);
                logger.warn(key + &#x27; not found in &#x27;+ url + &#x27; extracted data&#x27;);
            }
        }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.cssSelector" id="apidoc.element.neocrawler.extractor.prototype.cssSelector">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>cssSelector
        <span class="apidocSignatureSpan">($, expression, pick, index)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">cssSelector = function ($, expression, pick, index){
//    logger.debug(&#x27;css expression: &#x27;+expression);
    if(!index)index=1;
    var real_index = parseInt(index) - 1;
    //if(real_index&#x3c;0)real_index=0;
    var tmp_val = $.find(expression);
    if(!pick)return tmp_val;
    if(typeof(tmp_val)===&#x27;object&#x27;){
        if(real_index&#x3e;=0){
            var val = tmp_val.eq(real_index);
            return this.cssSelectorPicker(val,pick);
        }else{
            var arrayResult = [];
            for(var i=0;i&#x3c;tmp_val.length;i++){
                var val = tmp_val.eq(i);
                arrayResult.push(this.cssSelectorPicker(val,pick));
            }
            if(arrayResult.length==1)arrayResult = arrayResult[0];
            return arrayResult;
        }
    }else {
        var val = tmp_val;
        return this.cssSelectorPicker(val,pick);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    new_relation = this.regexSelector(crawl_info[&#x27;url&#x27;],rule[&#x27;expression&#x27;],rule[&#x27;index&#
x27;]);
                }else{
                    new_relation = this.regexSelector(crawl_info[&#x27;content&#x27;],rule[&#x27;expression&#x27;],rule[&#x27;index
&#x27;]);
                }
                break;
            case &#x27;css&#x27;:
            default:
                new_relation = this.<span class="apidocCodeKeywordSpan">cssSelector</span>($.root(),rule[&#x27;expression&#x27;],
rule[&#x27;pick&#x27;],rule[&#x27;index&#x27;]);
                break;
        }
    }
    return util.format(&#x27;%s-&#x3e;%s&#x27;,origin_relation,new_relation);
}

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.cssSelectorPicker" id="apidoc.element.neocrawler.extractor.prototype.cssSelectorPicker">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>cssSelectorPicker
        <span class="apidocSignatureSpan">(val, pick)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">cssSelectorPicker = function (val, pick){
    var result;
    if(pick.startsWith(&#x27;@&#x27;)){
        result = val.attr(pick.slice(1));
    }
    else{
        switch(pick.toLowerCase()){
            case &#x27;text&#x27;:
            case &#x27;innertext&#x27;:
                result = val.text();
                break;
            case &#x27;html&#x27;:
            case &#x27;innerhtml&#x27;:
                result = val.html();
                break;
        }
    }
    //if(result)result = result.replace(/[\r\n\t]/g, &#x22;&#x22;).trim();
    if(result)result = result.trim();
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var real_index = parseInt(index) - 1;
//if(real_index&#x3c;0)real_index=0;
var tmp_val = $.find(expression);
if(!pick)return tmp_val;
if(typeof(tmp_val)===&#x27;object&#x27;){
    if(real_index&#x3e;=0){
        var val = tmp_val.eq(real_index);
        return this.<span class="apidocCodeKeywordSpan">cssSelectorPicker</span>(val,pick);
    }else{
        var arrayResult = [];
        for(var i=0;i&#x3c;tmp_val.length;i++){
            var val = tmp_val.eq(i);
            arrayResult.push(this.cssSelectorPicker(val,pick));
        }
        if(arrayResult.length==1)arrayResult = arrayResult[0];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.detectLink" id="apidoc.element.neocrawler.extractor.prototype.detectLink">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>detectLink
        <span class="apidocSignatureSpan">(link)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">detectLink = function (link){
    var urlobj = url.parse(link);
    var result = [];
    var domain = this.__getTopLevelDomain(urlobj[&#x27;hostname&#x27;]);
    if(domain &#x26;&#x26; this.spiderCore.spider.driller_rules[domain]!=undefined){
        var alias = this.spiderCore.spider.driller_rules[domain];
        for(a in alias){
            var url_pattern  = decodeURIComponent(alias[a][&#x27;url_pattern&#x27;]);
            var patt = new RegExp(url_pattern);
            if(patt.test(link)){
                result = [&#x27;driller:&#x27;+domain+&#x27;:&#x27;+a,alias[a]];
                break;
            }
        }

    }
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param links
 * @returns {{}}
 */
extractor.prototype.arrange_link = function(links){
var linkobj = {};
for(var i=0;i&#x3c;links.length;i++){
    var link = links[i];
    var matched_driller = this.<span class="apidocCodeKeywordSpan">detectLink</span>(link);
    if(matched_driller.length&#x3e;0){
        var driller_lib = &#x27;urllib:&#x27; + matched_driller[0];
        var driller_rule = matched_driller[1];
        if(typeof(driller_rule)!=&#x27;object&#x27;)driller_rule = JSON.parse(driller_rule);
        if(linkobj[driller_lib]==undefined)linkobj[driller_lib]=[];
        if(driller_rule[&#x27;id_parameter&#x27;]&#x26;&#x26;driller_rule[&#x27;id_parameter&#x27;].length&#x3e;0){
            var id_parameter = driller_rule[&#x27;id_parameter&#x27;];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.extract" id="apidoc.element.neocrawler.extractor.prototype.extract">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>extract
        <span class="apidocSignatureSpan">(crawl_info)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">extract = function (crawl_info){
    if(crawl_info[&#x27;origin&#x27;][&#x27;format&#x27;]==&#x27;binary&#x27;)return crawl_info;
    var extract_rule = this.spiderCore.spider.getDrillerRule(crawl_info[&#x27;origin&#x27;][&#x27;urllib&#x27;],&#x27;extract_rule&#x27;);

    if(crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]||extract_rule[&#x27;rule&#x27;]){
        var $ = cheerio.load(crawl_info[&#x27;content&#x27;]);
    }

    if(crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]){
        if(crawl_info[&#x27;drill_link&#x27;]){
            var drill_link = crawl_info[&#x27;drill_link&#x27;];
        }else{
            var drill_link = this.extract_link($,crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]);
        }

        var washed_link = this.wash_link(crawl_info[&#x27;url&#x27;],drill_link);
        crawl_info[&#x27;drill_link&#x27;] = this.arrange_link(washed_link);
        if(this.spiderCore.settings[&#x27;keep_link_relation&#x27;])crawl_info[&#x27;drill_relation&#x27;] = this.getDrillRelation($,crawl_info);
    }

    if(extract_rule[&#x27;rule&#x27;]&#x26;&#x26;!isEmpty(extract_rule[&#x27;rule&#x27;])){
        var extracted_data = this.extract_data(crawl_info[&#x27;url&#x27;],crawl_info[&#x27;content&#x27;],extract_rule,null,$.root());
        crawl_info[&#x27;extracted_data&#x27;] = extracted_data;
    }
    return crawl_info;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.extract_data" id="apidoc.element.neocrawler.extractor.prototype.extract_data">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>extract_data
        <span class="apidocSignatureSpan">(url, content, extract_rule, uppper_data, dom)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">extract_data = function (url, content, extract_rule, uppper_data, dom){
    var data = {};
    var self = this;
    if(extract_rule[&#x27;category&#x27;])data[&#x27;$category&#x27;] = extract_rule[&#x27;category&#x27;];
//    if(extract_rule[&#x27;require&#x27;])data[&#x27;$require&#x27;] = extract_rule[&#x27;require&#x27;];
    if(extract_rule[&#x27;relate&#x27;])data[&#x27;relate&#x27;] = uppper_data[extract_rule[&#x27;relate&#x27;]];
    for(i in extract_rule[&#x27;rule&#x27;]){
        if(extract_rule[&#x27;rule&#x27;].hasOwnProperty(i)){
            var rule = extract_rule[&#x27;rule&#x27;][i];
            var baser = content;
            if(rule[&#x27;base&#x27;]===&#x27;url&#x27;)baser = url;
            switch(rule[&#x27;mode&#x27;]){
                case &#x27;regex&#x27;:
                    var tmp_result = this.regexSelector(baser,rule[&#x27;expression&#x27;],rule[&#x27;index&#x27;]);
                    data[i] = tmp_result;
                    break;
                case &#x27;xpath&#x27;:
                    break;
                case &#x27;value&#x27;:
                    data[i] = rule[&#x27;expression&#x27;];
                    break;
                case &#x27;json&#x27;:
                    break;
                default://css selector
                    if(dom)baser = dom;
                    else baser = (cheerio.load(content)).root();
                    var pick = rule[&#x27;pick&#x27;];
                    if(rule[&#x27;subset&#x27;]){
                        pick = false;
                        (function(k){
                            var result_arr = [];
                            var tmp_result = self.cssSelector(baser,rule[&#x27;expression&#x27;],pick,rule[&#x27;index&#x27;]);
                            if(tmp_result){
                                tmp_result.each(function(x, elem) {
                                    var sub_dom = tmp_result.eq(x);
                                    result_arr.push(self.extract_data(url,content,rule[&#x27;subset&#x27;],data,sub_dom));
                                });
                            }
                            if(!isEmpty(result_arr))data[k] = result_arr;
                        })(i);
                    }else{
                        try{
                            var tmp_result = this.cssSelector(baser,rule[&#x27;expression&#x27;],pick,rule[&#x27;index&#x27;]);
                            if(tmp_result&#x26;&#x26;!isEmpty(tmp_result))data[i] = tmp_result;
                        } catch(e){
                            logger.error(url + &#x27; extract field &#x27;+ i + &#x27; error:&#x27;+e);
                        }
                    }

            }
            }
    }
    if(extract_rule[&#x27;require&#x27;]){
        var lacks = [];
        for(var c=0;c&#x3c;extract_rule[&#x27;require&#x27;].length;c++){
            var key = extract_rule[&#x27;require&#x27;][c];
            if(typeof(key)===&#x27;object&#x27;){
                var sublack = self.checksublack(key,data);
                if(sublack.length&#x3e;0)lacks = lacks.concat(sublack);
            }else{
                if(!data[key]){
                    lacks.push(key);
                    logger.warn(key + &#x27; not found in &#x27;+ url + &#x27; extracted data&#x27;);
                }
            }
        }
        if(!isEmpty(lacks)){
            logger.error(url + &#x27; extracted data lacks of &#x27;+lacks.join(&#x27;,&#x27;));
            self.spiderCore.spider.redis_cli2.zadd(&#x27;incomplete:data:url&#x27;,(new Date()).getTime(),url,function(err,result){
                //nothing
            });
            if(&#x27;data_lack_alert&#x27; in self.spiderCore.spider_extend)self.spiderCore.spider_extend.data_lack_alert(url,lacks);
        }else{
            self.spiderCore.spider.redis_cli2.zrem(&#x27;incomplete:data:url&#x27;,url,function(err,result){
                //nothing
            });
        }
    }
    return data;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

       var washed_link = this.wash_link(crawl_info[&#x27;url&#x27;],drill_link);
       crawl_info[&#x27;drill_link&#x27;] = this.arrange_link(washed_link);
       if(this.spiderCore.settings[&#x27;keep_link_relation&#x27;])crawl_info[&#x27;drill_relation&#x27;] = this.getDrillRelation
($,crawl_info);
   }

   if(extract_rule[&#x27;rule&#x27;]&#x26;&#x26;!isEmpty(extract_rule[&#x27;rule&#x27;])){
       var extracted_data = this.<span class="apidocCodeKeywordSpan">extract_data</span>(crawl_info[&#x27;url&#x27;],crawl_info[&#
x27;content&#x27;],extract_rule,null,$.root());
       crawl_info[&#x27;extracted_data&#x27;] = extracted_data;
   }
   return crawl_info;
}
/**
* extract data
* @param url
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.extract_link" id="apidoc.element.neocrawler.extractor.prototype.extract_link">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>extract_link
        <span class="apidocSignatureSpan">($, rules)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">extract_link = function ($, rules){
    var links = [];
    for(var i=0;i&#x3c;rules.length;i++){
        $(rules[i]).each(function(i, elem) {
            if(elem[&#x27;name&#x27;]==&#x27;img&#x27;)links.push($(this).attr(&#x27;src&#x27;));
	    else links.push($(this).attr(&#x27;href&#x27;));
        });
    }
    return links;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var $ = cheerio.load(crawl_info[&#x27;content&#x27;]);
}

if(crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]){
    if(crawl_info[&#x27;drill_link&#x27;]){
        var drill_link = crawl_info[&#x27;drill_link&#x27;];
    }else{
        var drill_link = this.<span class="apidocCodeKeywordSpan">extract_link</span>($,crawl_info[&#x27;origin&#x27;][&#x27;drill_rules
&#x27;]);
    }

    var washed_link = this.wash_link(crawl_info[&#x27;url&#x27;],drill_link);
    crawl_info[&#x27;drill_link&#x27;] = this.arrange_link(washed_link);
    if(this.spiderCore.settings[&#x27;keep_link_relation&#x27;])crawl_info[&#x27;drill_relation&#x27;] = this.getDrillRelation($,
crawl_info);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.getDrillRelation" id="apidoc.element.neocrawler.extractor.prototype.getDrillRelation">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>getDrillRelation
        <span class="apidocSignatureSpan">($, crawl_info)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDrillRelation = function ($, crawl_info){
    //var rule = crawl_info[&#x27;origin&#x27;][&#x27;drill_relation_rule&#x27;];//rule: {&#x22;base&#x22;:&#x22;content&#x22;,&#x22;mode&#x22;:&#x22;css&#x22;,&#x22;expression&#x22;:&#x22;#breadCrumb&#x22;,&#x22;
pick&#x22;:&#x22;innerText&#x22;,&#x22;index&#x22;:1}
    var rule = this.spiderCore.spider.getDrillerRule(crawl_info[&#x27;origin&#x27;][&#x27;urllib&#x27;],&#x27;drill_relation&#x27;);
    var origin_relation = crawl_info[&#x27;origin&#x27;][&#x27;drill_relation&#x27;];
    if(!origin_relation)origin_relation = &#x27;*&#x27;;
    var new_relation = &#x27;*&#x27;;
    if(rule){
        switch(rule[&#x27;mode&#x27;]){
            case &#x27;regex&#x27;:
                if(rule[&#x27;base&#x27;]===&#x27;url&#x27;){
                    new_relation = this.regexSelector(crawl_info[&#x27;url&#x27;],rule[&#x27;expression&#x27;],rule[&#x27;index&#x27;]);
                }else{
                    new_relation = this.regexSelector(crawl_info[&#x27;content&#x27;],rule[&#x27;expression&#x27;],rule[&#x27;index&#x27;]);
                }
                break;
            case &#x27;css&#x27;:
            default:
                new_relation = this.cssSelector($.root(),rule[&#x27;expression&#x27;],rule[&#x27;pick&#x27;],rule[&#x27;index&#x27;]);
                break;
        }
    }
    return util.format(&#x27;%s-&#x3e;%s&#x27;,origin_relation,new_relation);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        var drill_link = crawl_info[&#x27;drill_link&#x27;];
    }else{
        var drill_link = this.extract_link($,crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]);
    }

    var washed_link = this.wash_link(crawl_info[&#x27;url&#x27;],drill_link);
    crawl_info[&#x27;drill_link&#x27;] = this.arrange_link(washed_link);
    if(this.spiderCore.settings[&#x27;keep_link_relation&#x27;])crawl_info[&#x27;drill_relation&#x27;] = this.<span class="apidocCodeKeywordSpan
">getDrillRelation</span>($,crawl_info);
}

if(extract_rule[&#x27;rule&#x27;]&#x26;&#x26;!isEmpty(extract_rule[&#x27;rule&#x27;])){
    var extracted_data = this.extract_data(crawl_info[&#x27;url&#x27;],crawl_info[&#x27;content&#x27;],extract_rule,null,$.root());
    crawl_info[&#x27;extracted_data&#x27;] = extracted_data;
}
return crawl_info;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.regexSelector" id="apidoc.element.neocrawler.extractor.prototype.regexSelector">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>regexSelector
        <span class="apidocSignatureSpan">(content, expression, index)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">regexSelector = function (content, expression, index){
    var index = parseInt(index);
    if(index==0)index=1;
    var expression = new RegExp(expression,&#x22;ig&#x22;);
    if(index&#x3e;0){
        var matched = expression.exec(content);
        if(matched&#x26;&#x26;matched.length&#x3e;index)return matched[index];
    }else{
        var arr = [],matched;
        while (matched = expression.exec(content))
            arr.push(matched[1]);
        return arr;
    }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var origin_relation = crawl_info[&#x27;origin&#x27;][&#x27;drill_relation&#x27;];
if(!origin_relation)origin_relation = &#x27;*&#x27;;
var new_relation = &#x27;*&#x27;;
if(rule){
    switch(rule[&#x27;mode&#x27;]){
        case &#x27;regex&#x27;:
            if(rule[&#x27;base&#x27;]===&#x27;url&#x27;){
                new_relation = this.<span class="apidocCodeKeywordSpan">regexSelector</span>(crawl_info[&#x27;url&#x27;],rule[&#
x27;expression&#x27;],rule[&#x27;index&#x27;]);
            }else{
                new_relation = this.regexSelector(crawl_info[&#x27;content&#x27;],rule[&#x27;expression&#x27;],rule[&#x27;index&#
x27;]);
            }
            break;
        case &#x27;css&#x27;:
        default:
            new_relation = this.cssSelector($.root(),rule[&#x27;expression&#x27;],rule[&#x27;pick&#x27;],rule[&#x27;index&#x27;]);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.validateContent" id="apidoc.element.neocrawler.extractor.prototype.validateContent">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>validateContent
        <span class="apidocSignatureSpan">(crawl_info)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validateContent = function (crawl_info){
    var self = this;
    var result = true;
    var statusCode = parseInt(crawl_info[&#x27;statusCode&#x27;]);
    var limitation = 500;
    if(crawl_info[&#x27;origin&#x27;][&#x27;format&#x27;]==&#x27;binary&#x27;)limitation = 20;
    if(statusCode===200){
        if(crawl_info[&#x27;content&#x27;].length&#x3c;limitation){
            logger.error(util.format(&#x27;Too little content: %s, length:%s&#x27;,crawl_info[&#x27;url&#x27;],crawl_info[&#x27;content&#x27;].length));
            result = false;
        }
        if(crawl_info[&#x27;origin&#x27;][&#x27;validation_keywords&#x27;]){
            for(var i =0;i&#x3c;crawl_info[&#x27;origin&#x27;][&#x27;validation_keywords&#x27;].length;i++){
                var keyword = crawl_info[&#x27;origin&#x27;][&#x27;validation_keywords&#x27;][i];
                if(crawl_info[&#x27;content&#x27;].indexOf(keyword)&#x3c;0){
                    logger.error(util.format(&#x27;%s lacked keyword: %s&#x27;,crawl_info[&#x27;url&#x27;],keyword));
                    result = false;break;
                }
            }
        }
    }else{
        logger.error(util.format(&#x27;url:%s, status code: %s&#x27;,crawl_info[&#x27;url&#x27;],statusCode));
        if(statusCode&#x3e;300)result=false;//30x,40x,50x
    }
    if(self.spiderCore.settings[&#x27;to_much_fail_exit&#x27;]){
        self.cumulative_failure +=  result?-1:1
        if(self.cumulative_failure&#x3c;0)self.cumulative_failure = 0;
        if(self.cumulative_failure&#x3e;self.spiderCore.settings[&#x27;spider_concurrency&#x27;]*1.5){
            logger.fatal(&#x27;too much fail, exit. &#x27;+self.cumulative_failure);
            process.exit(1);
        }
    }
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.extractor.prototype.wash_link" id="apidoc.element.neocrawler.extractor.prototype.wash_link">
        function <span class="apidocSignatureSpan">neocrawler.extractor.prototype.</span>wash_link
        <span class="apidocSignatureSpan">(pageurl, links)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wash_link = function (pageurl, links){
    //url resolve
    var cleaned_link = [];
    for(var i=0;i&#x3c;links.length;i++){
        if(!links[i])continue;
        var link = links[i].trim();
        if(!(link.startsWith(&#x27;#&#x27;)||link.startsWith(&#x27;javascript&#x27;)||link.startsWith(&#x27;void(&#x27;))){
            try{
                var the_url = url.resolve(pageurl,link);
                if(the_url!=pageurl)cleaned_link.push(the_url);
            }catch(e){
                logger.error(&#x27;Url resolve error: &#x27;+pageurl+&#x27;, &#x27;+link);
            }

        }
    }
    return arrayUnique(cleaned_link);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if(crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]){
    if(crawl_info[&#x27;drill_link&#x27;]){
        var drill_link = crawl_info[&#x27;drill_link&#x27;];
    }else{
        var drill_link = this.extract_link($,crawl_info[&#x27;origin&#x27;][&#x27;drill_rules&#x27;]);
    }

    var washed_link = this.<span class="apidocCodeKeywordSpan">wash_link</span>(crawl_info[&#x27;url&#x27;],drill_link);
    crawl_info[&#x27;drill_link&#x27;] = this.arrange_link(washed_link);
    if(this.spiderCore.settings[&#x27;keep_link_relation&#x27;])crawl_info[&#x27;drill_relation&#x27;] = this.getDrillRelation($,
crawl_info);
}

if(extract_rule[&#x27;rule&#x27;]&#x26;&#x26;!isEmpty(extract_rule[&#x27;rule&#x27;])){
    var extracted_data = this.extract_data(crawl_info[&#x27;url&#x27;],crawl_info[&#x27;content&#x27;],extract_rule,null,$.root());
    crawl_info[&#x27;extracted_data&#x27;] = extracted_data;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.filter_list" id="apidoc.module.neocrawler.filter_list">module neocrawler.filter_list</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.filter_list.filter_list" id="apidoc.element.neocrawler.filter_list.filter_list">
        function <span class="apidocSignatureSpan">neocrawler.</span>filter_list
        <span class="apidocSignatureSpan">(operator, filter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FilterList(operator, filter) {
  var _ref;
  this.operator = operator;
  this.get = __bind(this.get, this);
  this.addFilter = __bind(this.addFilter, this);
  if ((_ref = this.operator) !== &#x27;MUST_PASS_ALL&#x27; &#x26;&#x26; _ref !== &#x27;MUST_PASS_ONE&#x27;) {
    this.operator = &#x27;MUST_PASS_ALL&#x27;;
  }
  this.filters = [];
  if (filter) {
    filter = getFilter(filter);
    if (!filter) {
      return false;
    }
    this.filters.push(filter);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.filter_list.prototype" id="apidoc.module.neocrawler.filter_list.prototype">module neocrawler.filter_list.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.filter_list.prototype.addFilter" id="apidoc.element.neocrawler.filter_list.prototype.addFilter">
        function <span class="apidocSignatureSpan">neocrawler.filter_list.prototype.</span>addFilter
        <span class="apidocSignatureSpan">(filter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addFilter = function (filter) {
  filter = getFilter(filter);
  if (!filter) {
    return false;
  }
  return this.filters.push(filter);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.filter_list.prototype.get" id="apidoc.element.neocrawler.filter_list.prototype.get">
        function <span class="apidocSignatureSpan">neocrawler.filter_list.prototype.</span>get
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function () {
  return {
    operator: this.operator,
    filters: this.filters
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var redis_cli = function(host,port){
    this.ssdb_cli = SSDB.connect(host, port,30*1000,function(err,errobj){
        if(err)throw errobj;
    });
}

redis_cli.prototype.get = function(key,callback){
    this.ssdb_cli.<span class="apidocCodeKeywordSpan">get</span>(key,callback);
}

redis_cli.prototype.set = function(key,value,callback){
    this.ssdb_cli.set(key,value,callback);
}

redis_cli.prototype.expire = function(key,sec,callback){
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.gbk" id="apidoc.module.neocrawler.gbk">module neocrawler.gbk</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.gbk.dc_GBK" id="apidoc.element.neocrawler.gbk.dc_GBK">
        function <span class="apidocSignatureSpan">neocrawler.gbk.</span>dc_GBK
        <span class="apidocSignatureSpan">(arr)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">dc_GBK = function (arr){
	var kb = &#x27;&#x27;,str=&#x22;&#x22;;
	for(var n = 0 , max = arr.length; n&#x3c;max ; n++){
		var Code = arr[n];
		if(Code &#x26; 0x80){
			str += String.fromCharCode(ua[Code &#x3c;&#x3c; 8 | arr[++n]]);
		}else{
			str += String.fromCharCode(Code);
		}
	}
	return str;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    loc={};
if(lx == REDIRECT_MODE_1){//Country
    ipwz = setBuffer3(ipwz+1); //
    lx = ipFileBuffer.readUInt8(ipwz); //
    var Gjbut;
    if (lx == REDIRECT_MODE_2){//
        Gjbut = setIpFileString(setBuffer3(ipwz+1));
        loc.Country = GBK.<span class="apidocCodeKeywordSpan">dc_GBK</span>(Gjbut);
        ipwz = ipwz + 4;
    }else{
        Gjbut = setIpFileString(ipwz)
        loc.Country = GBK.dc_GBK(Gjbut);
        ipwz += Gjbut.length + 1;
    }
    loc.Area = ReadArea(ipwz);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.get" id="apidoc.module.neocrawler.get">module neocrawler.get</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.get.get" id="apidoc.element.neocrawler.get.get">
        function <span class="apidocSignatureSpan">neocrawler.</span>get
        <span class="apidocSignatureSpan">(row)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Get(row) {
  this.row = row;
  this.getRow = __bind(this.getRow, this);
  this.getFields = __bind(this.getFields, this);
  this.setTimeRange = __bind(this.setTimeRange, this);
  this.setMaxVersions = __bind(this.setMaxVersions, this);
  this.addColumn = __bind(this.addColumn, this);
  this.tr = {
    from: null,
    to: null
  };
  this.familyMap = {};
  this.maxVersions = 1;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var redis_cli = function(host,port){
    this.ssdb_cli = SSDB.connect(host, port,30*1000,function(err,errobj){
        if(err)throw errobj;
    });
}

redis_cli.prototype.get = function(key,callback){
    this.ssdb_cli.<span class="apidocCodeKeywordSpan">get</span>(key,callback);
}

redis_cli.prototype.set = function(key,value,callback){
    this.ssdb_cli.set(key,value,callback);
}

redis_cli.prototype.expire = function(key,sec,callback){
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.get.prototype" id="apidoc.module.neocrawler.get.prototype">module neocrawler.get.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.get.prototype.addColumn" id="apidoc.element.neocrawler.get.prototype.addColumn">
        function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>addColumn
        <span class="apidocSignatureSpan">(cf, qualifier)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addColumn = function (cf, qualifier) {
  var _base;
  if ((_base = this.familyMap)[cf] == null) {
    _base[cf] = [];
  }
  this.familyMap[cf].push(qualifier);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.get.prototype.getFields" id="apidoc.element.neocrawler.get.prototype.getFields">
        function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>getFields
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFields = function () {
  var cf, o, qualifiers, _ref;
  o = {
    row: this.row,
    timeRange: this.tr,
    column: [],
    maxVersions: this.maxVersions
  };
  _ref = this.familyMap;
  for (cf in _ref) {
    qualifiers = _ref[cf];
    o.column = {
      family: cf,
      qualifier: qualifiers.map(function(qualifier) {
        return qualifier;
      })
    };
  }
  return o;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.get.prototype.getRow" id="apidoc.element.neocrawler.get.prototype.getRow">
        function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>getRow
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getRow = function () {
  return this.row;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.get.prototype.setMaxVersions" id="apidoc.element.neocrawler.get.prototype.setMaxVersions">
        function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>setMaxVersions
        <span class="apidocSignatureSpan">(maxVersions)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setMaxVersions = function (maxVersions) {
  if (maxVersions &#x3c;= 0) {
    maxVersions = 1;
  }
  this.maxVersions = maxVersions;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.get.prototype.setTimeRange" id="apidoc.element.neocrawler.get.prototype.setTimeRange">
        function <span class="apidocSignatureSpan">neocrawler.get.prototype.</span>setTimeRange
        <span class="apidocSignatureSpan">(minStamp, maxStamp)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setTimeRange = function (minStamp, maxStamp) {
  this.tr = {
    from: minStamp,
    to: maxStamp
  };
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.gfw_proxy" id="apidoc.module.neocrawler.gfw_proxy">module neocrawler.gfw_proxy</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.gfw_proxy" id="apidoc.element.neocrawler.gfw_proxy.gfw_proxy">
        function <span class="apidocSignatureSpan">neocrawler.</span>gfw_proxy
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">gfw_proxy = function (settings){
	events.EventEmitter.call(this);//eventemitter inherits
	this.settings = settings;
	logger = settings[&#x27;logger&#x27;];
    this.handleCount = 0;//proxy handle count. once proxy list change, reset to 0.
    this.proxyServeMap = {};
    this.availableProxies = {};/*{domain:{$IP$:true}}*/
    this.resolvCache = {
        &#x27;192.168.72.11&#x27;:false,
        &#x27;192.168.72.29&#x27;:false,
        &#x27;192.168.72.34&#x27;:false
    };
    this.dnsCache = {
        &#x27;backee&#x27;:&#x27;10.1.1.122&#x27;
    };
    qqwry.info();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.super_" id="apidoc.element.neocrawler.gfw_proxy.super_">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.gfw_proxy.prototype" id="apidoc.module.neocrawler.gfw_proxy.prototype">module neocrawler.gfw_proxy.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.__chooseProxy" id="apidoc.element.neocrawler.gfw_proxy.prototype.__chooseProxy">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__chooseProxy
        <span class="apidocSignatureSpan">(domain, ip, header, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__chooseProxy = function (domain, ip, header, callback){
    var proxyRouter = this;
    this.handleCount++;
    if(header[&#x27;void-proxy&#x27;]){
	logger.warn(&#x27;Receive void proxy:&#x27;+header[&#x27;void-proxy&#x27;]);
        proxyRouter.__voteProxy(domain,header[&#x27;void-proxy&#x27;],false);
        proxyRouter.__getProxyFromDb(domain,function(proxyAddr){
            callback(proxyAddr);
        });
    }
    if(header[&#x27;client_pid&#x27;]&#x26;&#x26;header[&#x27;page&#x27;]){
        var browserId = ip+&#x27;:&#x27;+header[&#x27;client_pid&#x27;];
        if(!this.proxyServeMap[browserId]||this.proxyServeMap[browserId][0]!==header[&#x27;page&#x27;]||!this.availableProxies[domain][this
.proxyServeMap[browserId][1]]){
            proxyRouter.__getProxyFromDb(domain,function(domain,proxyAddr){
                if(proxyAddr){
                    proxyRouter.proxyServeMap[browserId] = [header[&#x27;page&#x27;],proxyAddr];
                }
                callback(proxyAddr);
            });
        }else {
            callback(this.proxyServeMap[browserId][1]);
        }
    }else{
        proxyRouter.__getProxyFromDb(domain,function(proxyAddr){
            callback(proxyAddr);
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var startTime = (new Date()).getTime();
var urlobj = url.parse(request.url);
var domain = proxyRouter.__getTopLevelDomain(urlobj[&#x27;hostname&#x27;]);
logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
//var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
//var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
var route = true;
proxyRouter.<span class="apidocCodeKeywordSpan">__chooseProxy</span>(domain,request.socket.remoteAddress,request.headers,function
(proxyAddr){
    if(route&#x26;&#x26;proxyAddr){
        var choseProxy = proxyAddr.split(&#x27;:&#x27;);
        var remoteProxyHost = choseProxy[0];
        var remoteProxyPort = choseProxy[1];
        var proxy_request = http.request({&#x27;host&#x27;:remoteProxyHost,&#x27;port&#x27;:remoteProxyPort,&#x27;method&#x27;:request
.method,&#x27;path&#x27;:request.url,&#x27;headers&#x27;:request.headers});
    }else{
        var proxy_request = http.request({&#x27;host&#x27;:urlobj[&#x27;host&#x27;],&#x27;port&#x27;:urlobj[&#x27;port&#x27;],&#
x27;method&#x27;:request.method,&#x27;path&#x27;:request.url,&#x27;headers&#x27;:request.headers});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.__getProxyFromDb" id="apidoc.element.neocrawler.gfw_proxy.prototype.__getProxyFromDb">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__getProxyFromDb
        <span class="apidocSignatureSpan">(domain, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__getProxyFromDb = function (domain, callback){
    var self = this;
    var proxyAddr;
    if(this.availableProxies[domain]){
        for(var k in this.availableProxies[domain]){
            if(this.availableProxies[domain].hasOwnProperty(k)){
                proxyAddr = k;
                logger.debug(&#x27;get proxy &#x27;+k+&#x27; from cache &#x27;+domain);
                break;
            }
        }
    }
    if(proxyAddr)callback(proxyAddr);
    else{
        self.redis_cli3.lpop(PROXY_KEYS,function(err,ip){
            if(err)logger.error(&#x27;Encountered error pop proxy from redis: &#x27;+err);
            else logger.debug(&#x27;get proxy &#x27;+ip+&#x27; from redis &#x27;);
            callback(ip);
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
proxyRouter.prototype.__chooseProxy = function(domain,ip,header,callback){
var proxyRouter = this;
this.handleCount++;
if(header[&#x27;void-proxy&#x27;]){
	logger.warn(&#x27;Receive void proxy:&#x27;+header[&#x27;void-proxy&#x27;]);
    proxyRouter.__voteProxy(domain,header[&#x27;void-proxy&#x27;],false);
    proxyRouter.<span class="apidocCodeKeywordSpan">__getProxyFromDb</span>(domain,function(proxyAddr){
        callback(proxyAddr);
    });
}
if(header[&#x27;client_pid&#x27;]&#x26;&#x26;header[&#x27;page&#x27;]){
    var browserId = ip+&#x27;:&#x27;+header[&#x27;client_pid&#x27;];
    if(!this.proxyServeMap[browserId]||this.proxyServeMap[browserId][0]!==header[&#x27;page&#x27;]||!this.availableProxies[domain
][this.proxyServeMap[browserId][1]]){
        proxyRouter.__getProxyFromDb(domain,function(domain,proxyAddr){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.__getTopLevelDomain" id="apidoc.element.neocrawler.gfw_proxy.prototype.__getTopLevelDomain">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__getTopLevelDomain
        <span class="apidocSignatureSpan">(domain)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__getTopLevelDomain = function (domain){
    var arr = domain.split(&#x27;.&#x27;);
    if(arr.length&#x3c;=2)return domain;
    else return arr.slice(1).join(&#x27;.&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
proxyRouter.prototype.proxyDaemon = function(){
var proxyRouter = this;
var httpProxyServer = http.createServer(function(request, response) {
    var timeOuter = false;
    var startTime = (new Date()).getTime();
    var urlobj = url.parse(request.url);
    var domain = proxyRouter.<span class="apidocCodeKeywordSpan">__getTopLevelDomain</span>(urlobj[&#x27;hostname&#x27;]);
    logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
    //var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
    //var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
    var route = true;
    proxyRouter.__chooseProxy(domain,request.socket.remoteAddress,request.headers,function(proxyAddr){
        if(route&#x26;&#x26;proxyAddr){
            var choseProxy = proxyAddr.split(&#x27;:&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.__voteProxy" id="apidoc.element.neocrawler.gfw_proxy.prototype.__voteProxy">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>__voteProxy
        <span class="apidocSignatureSpan">(domain, ip, score, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__voteProxy = function (domain, ip, score, callback){
    var self = this;
    if(!self.availableProxies[domain])self.availableProxies[domain] = {};
    if(score&#x26;&#x26;ip){
        if(self.availableProxies[domain][ip]){
            logger.debug(&#x27;Vote &#x27;+ip+&#x27; available to cache, &#x27;+domain);
            if(callback)callback();
        }else {
            self.availableProxies[domain][ip] = true;
            self.redis_cli3.lpush(PROXY_KEYS,ip,function(err){
                if(err)logger.error(&#x27;Encountered error vote proxy to redis&#x27;);
                else logger.info(&#x27;Vote &#x27;+ip+&#x27; available to redis, &#x27;+domain);
                if(callback)callback(err);
            });
        }
    }else{
        if(ip)delete self.availableProxies[domain][ip];
        logger.warn(&#x27;Vote &#x27;+ip+&#x27; not available&#x27;);
        if(callback)callback();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @private
 */
proxyRouter.prototype.__chooseProxy = function(domain,ip,header,callback){
var proxyRouter = this;
this.handleCount++;
if(header[&#x27;void-proxy&#x27;]){
	logger.warn(&#x27;Receive void proxy:&#x27;+header[&#x27;void-proxy&#x27;]);
    proxyRouter.<span class="apidocCodeKeywordSpan">__voteProxy</span>(domain,header[&#x27;void-proxy&#x27;],false);
    proxyRouter.__getProxyFromDb(domain,function(proxyAddr){
        callback(proxyAddr);
    });
}
if(header[&#x27;client_pid&#x27;]&#x26;&#x26;header[&#x27;page&#x27;]){
    var browserId = ip+&#x27;:&#x27;+header[&#x27;client_pid&#x27;];
    if(!this.proxyServeMap[browserId]||this.proxyServeMap[browserId][0]!==header[&#x27;page&#x27;]||!this.availableProxies[domain
][this.proxyServeMap[browserId][1]]){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.ipInChina" id="apidoc.element.neocrawler.gfw_proxy.prototype.ipInChina">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>ipInChina
        <span class="apidocSignatureSpan">(ip)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ipInChina = function (ip){
    var ipL = qqwry.searchIP(ip);
    var inChina = true;
    if(ipL) {
        logger.debug(JSON.stringify(ipL));
        if (ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
            ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;)
            )inChina = false;
    }
    logger.debug(ip+&#x27; in China? &#x27;+inChina);
    return inChina;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var self = this;
if(this.resolvCache.hasOwnProperty(hostname)){
    callback(this.resolvCache[hostname]);
}else{
    if(/^[\d\.]+$/.test(hostname)){
        if(hostname.startsWith(&#x27;192.168&#x27;)||hostname.startsWith(&#x27;10.1&#x27;))callback(false);
        else{
            var isInChina = this.<span class="apidocCodeKeywordSpan">ipInChina</span>(hostname);
            this.resolvCache[hostname] = isInChina?false:true;
            callback(isInChina?false:true);
        }
    }else{
        if(this.dnsCache[hostname]){
            var address = this.dnsCache[hostname];
            if(address.startsWith(&#x27;192.168&#x27;)||address.startsWith(&#x27;10.1&#x27;))callback(false);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.needProxy" id="apidoc.element.neocrawler.gfw_proxy.prototype.needProxy">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>needProxy
        <span class="apidocSignatureSpan">(hostname, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">needProxy = function (hostname, callback){
    var self = this;
    if(this.resolvCache.hasOwnProperty(hostname)){
        callback(this.resolvCache[hostname]);
    }else{
        if(/^[\d\.]+$/.test(hostname)){
            if(hostname.startsWith(&#x27;192.168&#x27;)||hostname.startsWith(&#x27;10.1&#x27;))callback(false);
            else{
                var isInChina = this.ipInChina(hostname);
                this.resolvCache[hostname] = isInChina?false:true;
                callback(isInChina?false:true);
            }
        }else{
            if(this.dnsCache[hostname]){
                var address = this.dnsCache[hostname];
                if(address.startsWith(&#x27;192.168&#x27;)||address.startsWith(&#x27;10.1&#x27;))callback(false);
                else{
                    var isInChina = this.ipInChina(address);
                    this.resolvCache[hostname] = isInChina?false:true;
                    callback(isInChina?false:true);
                }
            }else{
                dns.resolve4(hostname,function(err,addresses){
                    if(err||!addresses){
                        console.error(err);
                        callback(true);
                    }else {
                        self.dnsCache[hostname] = addresses[0];
                        if(addresses[0].startsWith(&#x27;192.168&#x27;)||addresses[0].startsWith(&#x27;10.1&#x27;))callback(false);
                        else{
                            var isInChina = self.ipInChina(addresses[0]);
                            self.resolvCache[hostname] = isInChina?false:true;
                            callback(isInChina?false:true);
                        }
                    }
                });
            }
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var startTime = (new Date()).getTime();
var urlobj = url.parse(request.url);
var domain = proxyRouter.__getTopLevelDomain(urlobj[&#x27;hostname&#x27;]);
logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
//var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
//var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
var route = true;
proxyRouter.<span class="apidocCodeKeywordSpan">needProxy</span>(urlobj[&#x27;hostname&#x27;],function(bol){
    route = bol;
    logger.debug(urlobj[&#x27;hostname&#x27;]+&#x27; need proxy: &#x27;+route);
    proxyRouter.__chooseProxy(domain,request.socket.remoteAddress,request.headers,function(proxyAddr){
        if(route&#x26;&#x26;proxyAddr){
            var choseProxy = proxyAddr.split(&#x27;:&#x27;);
            var remoteProxyHost = choseProxy[0];
            var remoteProxyPort = choseProxy[1];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.proxyDaemon" id="apidoc.element.neocrawler.gfw_proxy.prototype.proxyDaemon">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>proxyDaemon
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">proxyDaemon = function (){
    var proxyRouter = this;
    var httpProxyServer = http.createServer(function(request, response) {
        var timeOuter = false;
        var startTime = (new Date()).getTime();
        var urlobj = url.parse(request.url);
        var domain = proxyRouter.__getTopLevelDomain(urlobj[&#x27;hostname&#x27;]);
        logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
        //var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
        //var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
        var route = true;
        proxyRouter.needProxy(urlobj[&#x27;hostname&#x27;],function(bol){
            route = bol;
            logger.debug(urlobj[&#x27;hostname&#x27;]+&#x27; need proxy: &#x27;+route);
            proxyRouter.__chooseProxy(domain,request.socket.remoteAddress,request.headers,function(proxyAddr){
                if(route&#x26;&#x26;proxyAddr){
                    var choseProxy = proxyAddr.split(&#x27;:&#x27;);
                    var remoteProxyHost = choseProxy[0];
                    var remoteProxyPort = choseProxy[1];
                    var proxy_request = http.request({&#x27;host&#x27;:remoteProxyHost,&#x27;port&#x27;:remoteProxyPort,&#x27;method&#x27;:request.method,&#x27;path
&#x27;:request.url,&#x27;headers&#x27;:request.headers});
                }else{
                    var proxy_request = http.request({&#x27;host&#x27;:urlobj[&#x27;host&#x27;],&#x27;port&#x27;:urlobj[&#x27;port&#x27;],&#x27;method&#x27;:request.method,&#x27;path&#x27;:
request.url,&#x27;headers&#x27;:request.headers});
                }
                //--proxy start---------------------------
                //proxy_request.setSocketKeepAlive(false);
                proxy_request.setTimeout(120000,function(){
                    logger.error(&#x27;Remote request timeout.&#x27;+request.url);
                    proxy_request.abort();
                    response.end();
                });

                var timer_start = (new Date()).getTime();
                logger.debug(util.format(&#x27;Request(%s) Forward to remote proxy server %s:%s&#x27;,request.url,remoteProxyHost,remoteProxyPort
));
                var remote_proxy_response = null;
                proxy_request.addListener(&#x27;response&#x27;, function (proxy_response) {
                    remote_proxy_response = proxy_response;
                    proxyRouter.__voteProxy(domain,proxyAddr,parseInt(proxy_response.statusCode)&#x3c;400);//vote proxy//flex mode
                    proxy_response.addListener(&#x27;data&#x27;, function(chunk) {
                        //logger.debug(&#x27;Write data to client&#x27;);
                        if(!response.socket||response.socket.destroyed){
                            logger.error(&#x27;client socket closed,oop! &#x27;+request.url);
                            response.end();
                            proxy_response.socket.destroy();
                            proxy_request.abort();
                            if(timeOuter){
                                clearTimeout(timeOuter);
                                timeOuter = false;
                            }
                        }else response.write(chunk, &#x27;binary&#x27;);
                    });

                    proxy_response.addListener(&#x27;end&#x27;, function() {
                        response.end();
                        logger.info(util.format(&#x27;Write data to client(%s) finish, used proxy: %s, cost: %s ms, url: %s&#x27;,request.
socket.remoteAddress,route?proxyAddr:&#x27;none&#x27;,(new Date()).getTime()-startTime,request.url));
                        remote_proxy_response = null;//reset
                        if(timeOuter){
                            clearTimeout(timeOuter);
                            timeOuter = false;
                        }
                    });

                    proxy_response.headers[&#x27;remoteproxy&#x27;] = util.format(&#x27;%s:%d&#x27;,remoteProxyHost,remoteProxyPort);
                    response.writeHead(proxy_response.statusCode, proxy_response.headers);
                    //response.write(util.format(&#x27;&#x3c;!--%s:%d--&#x3e;&#x27;,remoteProxyHost,remoteProxyPort), &#x27;binary&#x27;);
                    logger.debug(util.format(&#x27;Remote proxy response, %d, leng ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
   myredis.createClient(
       self.settings[&#x27;proxy_info_redis_db&#x27;][0],
       self.settings[&#x27;proxy_info_redis_db&#x27;][1],
       self.settings[&#x27;proxy_info_redis_db&#x27;][2],
       dbtype,
       function(err,cli){
           self.redis_cli3 = cli;
           self.<span class="apidocCodeKeywordSpan">proxyDaemon</span>();
       });
}

/**
* TOP Domain,e.g: www.baidu.com  -&#x3e; baidu.com
* @param domain
* @returns {*}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.gfw_proxy.prototype.start" id="apidoc.element.neocrawler.gfw_proxy.prototype.start">
        function <span class="apidocSignatureSpan">neocrawler.gfw_proxy.prototype.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (){
    var self = this;
    var dbtype = &#x27;redis&#x27;;
    if(self.settings[&#x27;use_ssdb&#x27;])dbtype = &#x27;ssdb&#x27;;
    myredis.createClient(
        self.settings[&#x27;proxy_info_redis_db&#x27;][0],
        self.settings[&#x27;proxy_info_redis_db&#x27;][1],
        self.settings[&#x27;proxy_info_redis_db&#x27;][2],
        dbtype,
        function(err,cli){
            self.redis_cli3 = cli;
            self.proxyDaemon();
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
);
var logger = log4js.getLogger(&#x27;shuttle&#x27;);
logger.setLevel(&#x27;DEBUG&#x27;);
settings[&#x27;logger&#x27;] = logger;
settings[&#x27;port&#x27;] = 1985;
var gfw_proxy = new (require(&#x27;./gfw-proxy.js&#x27;))(settings);

gfw_proxy.<span class="apidocCodeKeywordSpan">start</span>();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.httpRequest" id="apidoc.module.neocrawler.httpRequest">module neocrawler.httpRequest</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.httpRequest.cssExtract" id="apidoc.element.neocrawler.httpRequest.cssExtract">
        function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>cssExtract
        <span class="apidocSignatureSpan">(content, expression, pick, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">cssExtract = function (content, expression, pick, callback){
    if(typeof content==&#x27;string&#x27;)var $ = (cheerio.load(content)).root();
    else var $ = content;
    var tmp_val = $.find(expression);
    var val = tmp_val.eq(0);
    var result;
    if(pick.startsWith(&#x27;@&#x27;)){
        result = val.attr(pick.slice(1));
    }
    else{
        switch(pick.toLowerCase()){
            case &#x27;text&#x27;:
            case &#x27;innertext&#x27;:
                result = val.text();
                break;
            case &#x27;html&#x27;:
            case &#x27;innerhtml&#x27;:
                result = val.html();
                break;
        }
    }
    //if(result)result = result.replace(/[\r\n\t]/g, &#x22;&#x22;).trim();
    if(result)result = result.trim();
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.httpRequest.getDom" id="apidoc.element.neocrawler.httpRequest.getDom">
        function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>getDom
        <span class="apidocSignatureSpan">(content)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDom = function (content){
    return (cheerio.load(content)).root();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.httpRequest.regexExtract" id="apidoc.element.neocrawler.httpRequest.regexExtract">
        function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>regexExtract
        <span class="apidocSignatureSpan">(content, expression, index)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">regexExtract = function (content, expression, index){
    var index = parseInt(index);
    if(index==0)index=1;
    var expression = new RegExp(expression,&#x22;ig&#x22;);
    if(index&#x3e;0){
        var matched = expression.exec(content);
        if(matched&#x26;&#x26;matched.length&#x3e;index)return matched[index];
    }else{
        var arr = [],matched;
        while (matched = expression.exec(content))
            arr.push(matched[1]);
        return arr;
    }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.httpRequest.request" id="apidoc.element.neocrawler.httpRequest.request">
        function <span class="apidocSignatureSpan">neocrawler.httpRequest.</span>request
        <span class="apidocSignatureSpan">(url, referer, cookie, proxy, timeout, isbin, callback, param)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">request = function (url, referer, cookie, proxy, timeout, isbin, callback, param){
    var timeOuter = false;
    var callbackCount = 0;
    if(proxy){
        var proxyRouter = proxy.split(&#x27;:&#x27;);
        var __host = proxyRouter[0];
        var __port = proxyRouter[1];
        var __path =  url;
    }else{
        var urlobj = urlUtil.parse(url);
        var __host = urlobj[&#x27;hostname&#x27;];
        var __port = urlobj[&#x27;port&#x27;];
        var __path = urlobj[&#x27;path&#x27;];
    }
    var startTime = new Date();
    var options = {
        &#x27;host&#x27;: __host,
        &#x27;port&#x27;: __port,
        &#x27;path&#x27;: __path,
        &#x27;method&#x27;: &#x27;GET&#x27;,
        &#x27;headers&#x27;: {
            &#x22;User-Agent&#x22;:&#x22;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/
537.36&#x22;,
            &#x22;Accept&#x22;:&#x22;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#x22;,
            //&#x22;Accept-Encoding&#x22;:&#x22;gzip,deflate,sdch&#x22;,
            &#x22;Accept-Encoding&#x22;:&#x22;gzip&#x22;,
            &#x22;Accept-Language&#x22;:&#x22;zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4&#x22;
        }
    };

    if(cookie){
        var cookie_kvarray = [];
        for(var i=0; i&#x3c;cookie.length; i++){
            cookie_kvarray.push(cookie[i][&#x27;name&#x27;]+&#x27;=&#x27;+cookie[i][&#x27;value&#x27;]);
        }
        var cookies_str = cookie_kvarray.join(&#x27;;&#x27;);
        if(cookies_str.length&#x3e;0)options[&#x27;headers&#x27;][&#x27;Cookie&#x27;] = cookies_str;
    }

    if(referer)options[&#x27;headers&#x27;][&#x27;Referer&#x27;] = referer;

    var req = http.request(options, function(res) {
        if(res.statusCode==301||res.statusCode==302){
            if(res.headers[&#x27;location&#x27;]){
                return request(res.headers[&#x27;location&#x27;],referer,cookie,proxy,timeout,isbin,callback,param);
            }
        }

        var bufferHelper = new BufferHelper();

//        res.setEncoding(&#x27;utf8&#x27;);

        res.on(&#x27;data&#x27;, function (chunk) {
            bufferHelper.concat(chunk);
        });

        res.on(&#x27;end&#x27;, function () {
            //console.log(&#x27;Response end, &#x27;+url+&#x27; use proxy: &#x27;+proxy);
            if(timeOuter){
                clearTimeout(timeOuter);
                timeOuter = false;
            }
            if(!req)return callback(new Error(&#x27;time out&#x27;),504,null,null,param||callbackCount++);
            req = null;

            var page_encoding = get_page_encoding(res.headers);

            page_encoding = page_encoding.toLowerCase().replace(&#x27;\-&#x27;,&#x27;&#x27;);

            var res_encoding = res.headers[&#x27;content-encoding&#x27;];
            if (res_encoding == &#x27;gzip&#x27; &#x26;&#x26; typeof unzip != &#x27;undefined&#x27;) {
                unzip(bufferHelper.toBuffer(), function(err, buff) {
                    if (!err &#x26;&#x26; buff) {
                        if(isbin){if(callbackCount&#x3c;1)callback(null,res.statusCode,buff,page_encoding,param||callbackCount++);}
                        else {if(callbackCount&#x3c;1)callback(null,res.statusCode,iconv.decode(buff,page_encoding),page_encoding,param
||callbackCount++);}
                    }else {if(callbackCount&#x3c;1)callback(new Error(&#x27;gzip no content &#x27;+err),res.statusCode,null,page_encoding,param
||callbackCount++);}
                });
            } else if (res_encoding == &#x27;deflate&#x27; &#x26;&#x26; typeof inflate != &#x27;undefined&#x27;) {
                inflate(bufferHelper.toBuffer(), function(err, buff) {
                    if (!err &#x26;&#x26; buff) {
                        if(isbin){if(callbackCount&#x3c;1)callback(null,res.statusCode,buff,page_encoding,param||callbackCount++);}
                        else {if(callbackCount&#x3c;1)callback(null,res.statusCode,iconv.decode(buff,page_encoding),page_encoding,param
||callbackCount++);}
                    }else {if(callbackCount&#x3c;1)callback(new Error(&#x27;deflate no content &#x27;+err),res.statusCode,null,page_encoding,param
||callbackCount++);}
                });
            } else {
                if(isbin){if(callbackCount&#x3c;1)callback(null,res.statusCode,bufferHelper.toBuffer(),page_encoding,param||callbackCount
++);}
                else {if(callbackCount&#x3c;1)callback(null,res.statusCode,iconv.decode(bufferHelper.toBuffer(),page_encoding),page_encoding
,param||callbackCount++);}
            }
        });
    });

    timeOuter = setTimeout(function(){ ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
var cookies_str = cookie_kvarray.join(&#x27;;&#x27;);
if(cookies_str.length&#x3e;0)options[&#x27;headers&#x27;][&#x27;Cookie&#x27;] = cookies_str;
    }

    if(referer)options[&#x27;headers&#x27;][&#x27;Referer&#x27;] = referer;

    var req = http.<span class="apidocCodeKeywordSpan">request</span>(options, function(res) {
if(res.statusCode==301||res.statusCode==302){
    if(res.headers[&#x27;location&#x27;]){
        return request(res.headers[&#x27;location&#x27;],referer,cookie,proxy,timeout,isbin,callback,param);
    }
}

var bufferHelper = new BufferHelper();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.index" id="apidoc.module.neocrawler.index">module neocrawler.index</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.index.index" id="apidoc.element.neocrawler.index.index">
        function <span class="apidocSignatureSpan">neocrawler.</span>index
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">index = function (settings){
	events.EventEmitter.call(this);//eventemitter inherits
	this.settings = settings;
	logger = settings[&#x27;logger&#x27;];
    this.handleCount = 0;//proxy handle count. once proxy list change, reset to 0.
    this.proxyServeMap = {};
    this.availableProxies = {};/*{domain:{$IP$:true}}*/
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.index.super_" id="apidoc.element.neocrawler.index.super_">
        function <span class="apidocSignatureSpan">neocrawler.index.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.index.prototype" id="apidoc.module.neocrawler.index.prototype">module neocrawler.index.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.index.prototype.__chooseProxy" id="apidoc.element.neocrawler.index.prototype.__chooseProxy">
        function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__chooseProxy
        <span class="apidocSignatureSpan">(domain, ip, header, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__chooseProxy = function (domain, ip, header, callback){
    var proxyRouter = this;
    this.handleCount++;
    if(header[&#x27;void-proxy&#x27;]){
	logger.warn(&#x27;Receive void proxy:&#x27;+header[&#x27;void-proxy&#x27;]);
        proxyRouter.__voteProxy(domain,header[&#x27;void-proxy&#x27;],false);
        proxyRouter.__getProxyFromDb(domain,function(proxyAddr){
            callback(proxyAddr);
        });
    }
    if(header[&#x27;client_pid&#x27;]&#x26;&#x26;header[&#x27;page&#x27;]){
        var browserId = ip+&#x27;:&#x27;+header[&#x27;client_pid&#x27;];
        if(!this.proxyServeMap[browserId]||this.proxyServeMap[browserId][0]!==header[&#x27;page&#x27;]||!this.availableProxies[domain][this
.proxyServeMap[browserId][1]]){
            proxyRouter.__getProxyFromDb(domain,function(domain,proxyAddr){
                if(proxyAddr){
                    proxyRouter.proxyServeMap[browserId] = [header[&#x27;page&#x27;],proxyAddr];
                }
                callback(proxyAddr);
            });
        }else {
            callback(this.proxyServeMap[browserId][1]);
        }
    }else{
        proxyRouter.__getProxyFromDb(domain,function(proxyAddr){
            callback(proxyAddr);
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var startTime = (new Date()).getTime();
var urlobj = url.parse(request.url);
var domain = proxyRouter.__getTopLevelDomain(urlobj[&#x27;hostname&#x27;]);
logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
//var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
//var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
var route = true;
proxyRouter.<span class="apidocCodeKeywordSpan">__chooseProxy</span>(domain,request.socket.remoteAddress,request.headers,function
(proxyAddr){
    if(route&#x26;&#x26;proxyAddr){
        var choseProxy = proxyAddr.split(&#x27;:&#x27;);
        var remoteProxyHost = choseProxy[0];
        var remoteProxyPort = choseProxy[1];
        var proxy_request = http.request({&#x27;host&#x27;:remoteProxyHost,&#x27;port&#x27;:remoteProxyPort,&#x27;method&#x27;:request
.method,&#x27;path&#x27;:request.url,&#x27;headers&#x27;:request.headers});
    }else{
        var proxy_request = http.request({&#x27;host&#x27;:urlobj[&#x27;host&#x27;],&#x27;port&#x27;:urlobj[&#x27;port&#x27;],&#
x27;method&#x27;:request.method,&#x27;path&#x27;:request.url,&#x27;headers&#x27;:request.headers});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.index.prototype.__getProxyFromDb" id="apidoc.element.neocrawler.index.prototype.__getProxyFromDb">
        function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__getProxyFromDb
        <span class="apidocSignatureSpan">(domain, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__getProxyFromDb = function (domain, callback){
    var self = this;
    var proxyAddr;
    if(this.availableProxies[domain]){
        for(var k in this.availableProxies[domain]){
            if(this.availableProxies[domain].hasOwnProperty(k)){
                proxyAddr = k;
                logger.debug(&#x27;get proxy &#x27;+k+&#x27; from cache &#x27;+domain);
                break;
            }
        }
    }
    if(proxyAddr)callback(proxyAddr);
    else{
        self.redis_cli3.lpop(PROXY_KEYS,function(err,ip){
            if(err)logger.error(&#x27;Encountered error pop proxy from redis: &#x27;+err);
            else logger.debug(&#x27;get proxy &#x27;+ip+&#x27; from redis &#x27;);
            callback(ip);
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
proxyRouter.prototype.__chooseProxy = function(domain,ip,header,callback){
var proxyRouter = this;
this.handleCount++;
if(header[&#x27;void-proxy&#x27;]){
	logger.warn(&#x27;Receive void proxy:&#x27;+header[&#x27;void-proxy&#x27;]);
    proxyRouter.__voteProxy(domain,header[&#x27;void-proxy&#x27;],false);
    proxyRouter.<span class="apidocCodeKeywordSpan">__getProxyFromDb</span>(domain,function(proxyAddr){
        callback(proxyAddr);
    });
}
if(header[&#x27;client_pid&#x27;]&#x26;&#x26;header[&#x27;page&#x27;]){
    var browserId = ip+&#x27;:&#x27;+header[&#x27;client_pid&#x27;];
    if(!this.proxyServeMap[browserId]||this.proxyServeMap[browserId][0]!==header[&#x27;page&#x27;]||!this.availableProxies[domain
][this.proxyServeMap[browserId][1]]){
        proxyRouter.__getProxyFromDb(domain,function(domain,proxyAddr){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.index.prototype.__getTopLevelDomain" id="apidoc.element.neocrawler.index.prototype.__getTopLevelDomain">
        function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__getTopLevelDomain
        <span class="apidocSignatureSpan">(domain)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__getTopLevelDomain = function (domain){
    var arr = domain.split(&#x27;.&#x27;);
    if(arr.length&#x3c;=2)return domain;
    else return arr.slice(1).join(&#x27;.&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
proxyRouter.prototype.proxyDaemon = function(){
var proxyRouter = this;
var httpProxyServer = http.createServer(function(request, response) {
    var timeOuter = false;
    var startTime = (new Date()).getTime();
    var urlobj = url.parse(request.url);
    var domain = proxyRouter.<span class="apidocCodeKeywordSpan">__getTopLevelDomain</span>(urlobj[&#x27;hostname&#x27;]);
    logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
    //var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
    //var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
    var route = true;
    proxyRouter.__chooseProxy(domain,request.socket.remoteAddress,request.headers,function(proxyAddr){
        if(route&#x26;&#x26;proxyAddr){
            var choseProxy = proxyAddr.split(&#x27;:&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.index.prototype.__voteProxy" id="apidoc.element.neocrawler.index.prototype.__voteProxy">
        function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>__voteProxy
        <span class="apidocSignatureSpan">(domain, ip, score, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__voteProxy = function (domain, ip, score, callback){
    var self = this;
    if(!self.availableProxies[domain])self.availableProxies[domain] = {};
    if(score&#x26;&#x26;ip){
        if(self.availableProxies[domain][ip]){
            logger.debug(&#x27;Vote &#x27;+ip+&#x27; available to cache, &#x27;+domain);
            if(callback)callback();
        }else {
            self.availableProxies[domain][ip] = true;
            self.redis_cli3.lpush(PROXY_KEYS,ip,function(err){
                if(err)logger.error(&#x27;Encountered error vote proxy to redis&#x27;);
                else logger.info(&#x27;Vote &#x27;+ip+&#x27; available to redis, &#x27;+domain);
                if(callback)callback(err);
            });
        }
    }else{
        if(ip)delete self.availableProxies[domain][ip];
        logger.warn(&#x27;Vote &#x27;+ip+&#x27; not available&#x27;);
        if(callback)callback();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @private
 */
proxyRouter.prototype.__chooseProxy = function(domain,ip,header,callback){
var proxyRouter = this;
this.handleCount++;
if(header[&#x27;void-proxy&#x27;]){
	logger.warn(&#x27;Receive void proxy:&#x27;+header[&#x27;void-proxy&#x27;]);
    proxyRouter.<span class="apidocCodeKeywordSpan">__voteProxy</span>(domain,header[&#x27;void-proxy&#x27;],false);
    proxyRouter.__getProxyFromDb(domain,function(proxyAddr){
        callback(proxyAddr);
    });
}
if(header[&#x27;client_pid&#x27;]&#x26;&#x26;header[&#x27;page&#x27;]){
    var browserId = ip+&#x27;:&#x27;+header[&#x27;client_pid&#x27;];
    if(!this.proxyServeMap[browserId]||this.proxyServeMap[browserId][0]!==header[&#x27;page&#x27;]||!this.availableProxies[domain
][this.proxyServeMap[browserId][1]]){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.index.prototype.proxyDaemon" id="apidoc.element.neocrawler.index.prototype.proxyDaemon">
        function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>proxyDaemon
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">proxyDaemon = function (){
    var proxyRouter = this;
    var httpProxyServer = http.createServer(function(request, response) {
        var timeOuter = false;
        var startTime = (new Date()).getTime();
        var urlobj = url.parse(request.url);
        var domain = proxyRouter.__getTopLevelDomain(urlobj[&#x27;hostname&#x27;]);
        logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
        //var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
        //var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
        var route = true;
        proxyRouter.__chooseProxy(domain,request.socket.remoteAddress,request.headers,function(proxyAddr){
            if(route&#x26;&#x26;proxyAddr){
                var choseProxy = proxyAddr.split(&#x27;:&#x27;);
                var remoteProxyHost = choseProxy[0];
                var remoteProxyPort = choseProxy[1];
                var proxy_request = http.request({&#x27;host&#x27;:remoteProxyHost,&#x27;port&#x27;:remoteProxyPort,&#x27;method&#x27;:request.method,&#x27;path&#x27;:request
.url,&#x27;headers&#x27;:request.headers});
            }else{
                var proxy_request = http.request({&#x27;host&#x27;:urlobj[&#x27;host&#x27;],&#x27;port&#x27;:urlobj[&#x27;port&#x27;],&#x27;method&#x27;:request.method,&#x27;path&#x27;:request
.url,&#x27;headers&#x27;:request.headers});
            }
            //--proxy start---------------------------
            //proxy_request.setSocketKeepAlive(false);
            proxy_request.setTimeout(120000,function(){
                logger.error(&#x27;Remote request timeout.&#x27;+request.url);
                proxy_request.abort();
                response.end();
            });

            var timer_start = (new Date()).getTime();
            logger.debug(util.format(&#x27;Request(%s) Forward to remote proxy server %s:%s&#x27;,request.url,remoteProxyHost,remoteProxyPort
));
            var remote_proxy_response = null;
            proxy_request.addListener(&#x27;response&#x27;, function (proxy_response) {
                remote_proxy_response = proxy_response;
                proxyRouter.__voteProxy(domain,proxyAddr,parseInt(proxy_response.statusCode)&#x3c;400);//vote proxy//flex mode
                proxy_response.addListener(&#x27;data&#x27;, function(chunk) {
                    //logger.debug(&#x27;Write data to client&#x27;);
                    if(!response.socket||response.socket.destroyed){
                        logger.error(&#x27;client socket closed,oop! &#x27;+request.url);
                        response.end();
                        proxy_response.socket.destroy();
                        proxy_request.abort();
                        if(timeOuter){
                            clearTimeout(timeOuter);
                            timeOuter = false;
                        }
                    }else response.write(chunk, &#x27;binary&#x27;);
                });

                proxy_response.addListener(&#x27;end&#x27;, function() {
                    response.end();
                    logger.info(util.format(&#x27;Write data to client(%s) finish, used proxy: %s, cost: %s ms, url: %s&#x27;,request.socket
.remoteAddress,proxyAddr,(new Date()).getTime()-startTime,request.url));
                    remote_proxy_response = null;//reset
                    if(timeOuter){
                        clearTimeout(timeOuter);
                        timeOuter = false;
                    }
                });

                proxy_response.headers[&#x27;remoteproxy&#x27;] = util.format(&#x27;%s:%d&#x27;,remoteProxyHost,remoteProxyPort);
                response.writeHead(proxy_response.statusCode, proxy_response.headers);
                //response.write(util.format(&#x27;&#x3c;!--%s:%d--&#x3e;&#x27;,remoteProxyHost,remoteProxyPort), &#x27;binary&#x27;);
                logger.debug(util.format(&#x27;Remote proxy response, %d, length: %s, cost: %dms, url:%s&#x27;,proxy_response.statusCode,proxy_response
.headers[&#x27;Content-Length&#x27;],(new Date()).getTime()-timer_start,request.url));
            });

            proxy_request.addListener(&#x27;timeout&#x27;, function() {
                proxyRouter.__voteProxy(domain,proxyAddr,false);
                response.end();
                proxy_request.abort(); ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
   myredis.createClient(
       self.settings[&#x27;proxy_info_redis_db&#x27;][0],
       self.settings[&#x27;proxy_info_redis_db&#x27;][1],
       self.settings[&#x27;proxy_info_redis_db&#x27;][2],
       dbtype,
       function(err,cli){
           self.redis_cli3 = cli;
           self.<span class="apidocCodeKeywordSpan">proxyDaemon</span>();
       });
}

/**
* TOP Domain,e.g: www.baidu.com  -&#x3e; baidu.com
* @param domain
* @returns {*}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.index.prototype.start" id="apidoc.element.neocrawler.index.prototype.start">
        function <span class="apidocSignatureSpan">neocrawler.index.prototype.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (){
    var self = this;
    var dbtype = &#x27;redis&#x27;;
    if(self.settings[&#x27;use_ssdb&#x27;])dbtype = &#x27;ssdb&#x27;;
    myredis.createClient(
        self.settings[&#x27;proxy_info_redis_db&#x27;][0],
        self.settings[&#x27;proxy_info_redis_db&#x27;][1],
        self.settings[&#x27;proxy_info_redis_db&#x27;][2],
        dbtype,
        function(err,cli){
            self.redis_cli3 = cli;
            self.proxyDaemon();
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
);
var logger = log4js.getLogger(&#x27;shuttle&#x27;);
logger.setLevel(&#x27;DEBUG&#x27;);
settings[&#x27;logger&#x27;] = logger;
settings[&#x27;port&#x27;] = 1985;
var gfw_proxy = new (require(&#x27;./gfw-proxy.js&#x27;))(settings);

gfw_proxy.<span class="apidocCodeKeywordSpan">start</span>();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.line_reader" id="apidoc.module.neocrawler.line_reader">module neocrawler.line_reader</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.line_reader.eachLine" id="apidoc.element.neocrawler.line_reader.eachLine">
        function <span class="apidocSignatureSpan">neocrawler.line_reader.</span>eachLine
        <span class="apidocSignatureSpan">(filename, cb, separator, encoding, bufferSize)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function eachLine(filename, cb, separator, encoding, bufferSize) {
    var finalFn,
        asyncCb = cb.length == 3;

    function finish() {
        if (finalFn &#x26;&#x26; typeof finalFn === &#x27;function&#x27;) {
            finalFn();
        }
    }

    open(filename, function(reader) {
        function newRead() {
            if (reader.hasNextLine()) {
                setImmediate(readNext);
            } else {
                finish();
            }
        }

        function continueCb(continueReading) {
            if (continueReading !== false) {
                newRead();
            } else {
                finish();
                reader.close();
            }
        }

        function readNext() {
            reader.nextLine(function(line) {
                var last = !reader.hasNextLine();

                if (asyncCb) {
                    cb(line, last, continueCb);
                } else {
                    if (cb(line, last) !== false) {
                        newRead();
                    } else {
                        finish();
                        reader.close();
                    }
                }
            });
        }

        newRead();
    }, separator, encoding, bufferSize);

    return {
        then: function(cb) {
            finalFn = cb;
        }
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var restoredb = function(db){
redis.createClient(options[&#x27;h&#x27;],options[&#x27;p&#x27;],db,options[&#x27;t&#x27;],function(err,redis_cli)
{
    if(err)throw err;
    var count = 0;
    var key,value;
    lineReader.<span class="apidocCodeKeywordSpan">eachLine</span>(options[&#x27;f&#x27;], function(line, last,cb) {
        if(count++%2==0){
            key = line;
            if(last){
                redis_cli.quit();
                cb(false);
            }else cb();
        }else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.line_reader.open" id="apidoc.element.neocrawler.line_reader.open">
        function <span class="apidocSignatureSpan">neocrawler.line_reader.</span>open
        <span class="apidocSignatureSpan">(filename, cb, separator, encoding, bufferSize)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function open(filename, cb, separator, encoding, bufferSize) {
    fs.open(filename, &#x27;r&#x27;, parseInt(&#x27;666&#x27;, 8), function(err, fd) {
        var reader;
        if (err) {
            throw err;
        }

        reader = new LineReader(fd, function() {
            cb(reader);
        }, separator, encoding, bufferSize);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        this.nextLine = nextLine;
        this.close = close;

        readToSeparator(cb);
    }

    function open(filename, cb, separator, encoding, bufferSize) {
        fs.<span class="apidocCodeKeywordSpan">open</span>(filename, &#x27;r&#x27;, parseInt(&#x27;666&#x27;, 8), function(err,
fd) {
var reader;
if (err) {
    throw err;
}

reader = new LineReader(fd, function() {
    cb(reader);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.logging" id="apidoc.module.neocrawler.logging">module neocrawler.logging</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.logging.getLogger" id="apidoc.element.neocrawler.logging.getLogger">
        function <span class="apidocSignatureSpan">neocrawler.logging.</span>getLogger
        <span class="apidocSignatureSpan">(name, instance, level)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getLogger = function (name, instance, level){
	var log4js = require(&#x27;log4js&#x27;);
	log4js.configure({
					  &#x22;appenders&#x22;: [
					                {
					                  &#x22;type&#x22;: &#x22;dateFile&#x22;,
					                  &#x22;filename&#x22;: &#x22;logs/&#x22;+name+&#x22;-&#x22;+process.pid+&#x22;.log&#x22;,
					                  &#x22;pattern&#x22;: &#x22;-yyyy-MM-dd&#x22;,
					                  &#x22;alwaysIncludePattern&#x22;: false
					                },
					                {
					                  &#x22;type&#x22;: &#x22;console&#x22;
					                }
					              ]
		            },
		            {cwd: &#x27;instance/&#x27;+instance }
		            );
	var logger = log4js.getLogger(name);
	logger.setLevel(level);
	return logger;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
					                {
					                  &#x22;type&#x22;: &#x22;console&#x22;
					                }
					              ]
		            },
		            {cwd: &#x27;instance/&#x27;+instance }
		            );
	var logger = log4js.<span class="apidocCodeKeywordSpan">getLogger</span>(name);
	logger.setLevel(level);
	return logger;
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.myredis" id="apidoc.module.neocrawler.myredis">module neocrawler.myredis</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.myredis.createClient" id="apidoc.element.neocrawler.myredis.createClient">
        function <span class="apidocSignatureSpan">neocrawler.myredis.</span>createClient
        <span class="apidocSignatureSpan">(host, port, db, type, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createClient = function (host, port, db, type, callback){
    if(type==&#x27;ssdb&#x27;){
        var ssdb_cli = ssdb.client(host,port);
        callback(null,ssdb_cli);
    }else{
        var redis_cli = redis.createClient(port,host);
        redis_cli.hlist = function(name,callback){
            redis_cli.keys(name,callback);
        };
        redis_cli.hclear = function(name,callback){
            redis_cli.del(name,callback);
        };
        redis_cli.zlen = function(name,callback){
            redis_cli.zcount(name,0,(new Date()).getTime(),callback);
        };
        redis_cli.zlist = function(name,callback){
            redis_cli.keys(name,callback);
        };
        redis_cli.qlist = function(name,callback){
            redis_cli.keys(name,callback);
        };
        redis_cli.close = function(){
            redis_cli.quit();
        };
        redis_cli.select(db, function(err,value) {
            callback(err,redis_cli);
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var ssdb = require(&#x22;./ssdb_redis.js&#x22;);

exports.createClient = function(host,port,db,type,callback){
if(type==&#x27;ssdb&#x27;){
    var ssdb_cli = ssdb.client(host,port);
    callback(null,ssdb_cli);
}else{
    var redis_cli = redis.<span class="apidocCodeKeywordSpan">createClient</span>(port,host);
    redis_cli.hlist = function(name,callback){
        redis_cli.keys(name,callback);
    };
    redis_cli.hclear = function(name,callback){
        redis_cli.del(name,callback);
    };
    redis_cli.zlen = function(name,callback){
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.qqwry" id="apidoc.module.neocrawler.qqwry">module neocrawler.qqwry</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.DBUG" id="apidoc.element.neocrawler.qqwry.DBUG">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>DBUG
        <span class="apidocSignatureSpan">(a)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">DBUG = function (a){dbug = a != undefined ? a : true; return this;}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.info" id="apidoc.element.neocrawler.qqwry.info">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>info
        <span class="apidocSignatureSpan">(dataPath)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">info = function (dataPath){
    var fs = require(&#x27;fs&#x27;),
        Path = typeof(dataPath) == &#x22;string&#x22; ? dataPath : pathDefined;
    var callback = typeof arguments[arguments.length-1] == &#x22;function&#x22; ? arguments[arguments.length-1] : function(){};
    GBK = require(&#x22;./gbk.js&#x22;);
    ipFileBuffer = fs.readFileSync(Path); //IP;
    ipBegin = ipFileBuffer.readUInt32LE(0,true); //;
    ipEnd = ipFileBuffer.readUInt32LE(4,true); //;
    ipCount = (ipEnd-ipBegin)/7+1;
    dbug &#x26;&#x26; log(&#x22;==== Lib-qqwry Start! ==== [Begin:&#x22;+ipBegin+&#x22; End:&#x22;+ipEnd + &#x22; Count:&#x22; + ipCount + &#x22;]&#x22;);
    uninfo = false;
    callback();
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if(self.availableProxies[domain][ip]){
        logger.debug(&#x27;Vote &#x27;+ip+&#x27; available to cache, &#x27;+domain);
        if(callback)callback();
    }else {
        self.availableProxies[domain][ip] = true;
        self.redis_cli3.lpush(PROXY_KEYS,ip,function(err){
            if(err)logger.error(&#x27;Encountered error vote proxy to redis&#x27;);
            else logger.<span class="apidocCodeKeywordSpan">info</span>(&#x27;Vote &#x27;+ip+&#x27; available to redis, &#x27;+domain
);
            if(callback)callback(err);
        });
    }
}else{
    if(ip)delete self.availableProxies[domain][ip];
    logger.warn(&#x27;Vote &#x27;+ip+&#x27; not available&#x27;);
    if(callback)callback();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.infoAsync" id="apidoc.element.neocrawler.qqwry.infoAsync">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>infoAsync
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">infoAsync = function (){
    var o = this,args = arguments;
    setTimeout(function(){o.info.apply(o,args)});
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.intToIP" id="apidoc.element.neocrawler.qqwry.intToIP">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>intToIP
        <span class="apidocSignatureSpan">(INT)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">intToIP = function (INT){
    if(INT &#x3c; 0 || INT &#x3e; 0xFFFFFFFF){
        throw (&#x22;The number is not normal! &#x3e;&#x3e; &#x22; + INT);
    };
    return (INT&#x3e;&#x3e;&#x3e;24) + &#x22;.&#x22; + (INT&#x3e;&#x3e;&#x3e;16 &#x26; 0xFF) + &#x22;.&#x22; + (INT&#x3e;&#x3e;&#x3e;8 &#x26; 0xFF) + &#x22;.&#x22; + (INT&#x3e;&#x3e;&#x3e;0 &#x26; 0xFF);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
exports.searchIP = function(IP){
    uninfo &#x26;&#x26; uninfo();
    var ip = this.ipToInt(IP),
        g = LocateIP(ip),
        loc={};
    if(g == -1){return {&#x22;ip&#x22;:IP,&#x22;Country&#x22;:unArea,&#x22;Area&#x22;:unCountry};}
    var add = setIPLocation(g);
    loc.ip = this.<span class="apidocCodeKeywordSpan">intToIP</span>(ip);
    loc.Country = add.Country;
    loc.Area = add.Area;
    dbug &#x26;&#x26; log(loc);
    return loc;
}

//IP;scope
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.ipEndianChange" id="apidoc.element.neocrawler.qqwry.ipEndianChange">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>ipEndianChange
        <span class="apidocSignatureSpan">(INT)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ipEndianChange = function (INT){
    INT = INT &#x26; 0xFFFFFFFF;
    return (INT &#x3e;&#x3e;&#x3e; 24 | (INT &#x3e;&#x3e; 8 &#x26; 0xFF00) | (INT &#x3c;&#x3c; 8 &#x26; 0xFF0000) | (INT &#x3c;&#x3c; 24)) &#x3e;&#x3e;&#x3e; 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.ipToInt" id="apidoc.element.neocrawler.qqwry.ipToInt">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>ipToInt
        <span class="apidocSignatureSpan">(IP)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ipToInt = function (IP){
    var result = IP_REGEXP.exec(IP),ip;
    if(result){
        var ip_Arr = result.slice(1);
        ip =(parseInt(ip_Arr[0]) &#x3c;&#x3c; 24
            | parseInt(ip_Arr[1]) &#x3c;&#x3c; 16
            | parseInt(ip_Arr[2]) &#x3c;&#x3c; 8
            | parseInt(ip_Arr[3])) &#x3e;&#x3e;&#x3e; 0;
    }else if(/^\d+$/.test(IP) &#x26;&#x26; (ip=parseInt(IP))&#x3e;=0 &#x26;&#x26; ip &#x3c;= 0xFFFFFFFF ){

    }else{
        throw (&#x22;The IP address is not normal! &#x3e;&#x3e; &#x22; + IP);
    }
    return ip;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
callback();
return this;
}

//IP
exports.searchIP = function(IP){
uninfo &#x26;&#x26; uninfo();
var ip = this.<span class="apidocCodeKeywordSpan">ipToInt</span>(IP),
    g = LocateIP(ip),
    loc={};
if(g == -1){return {&#x22;ip&#x22;:IP,&#x22;Country&#x22;:unArea,&#x22;Area&#x22;:unCountry};}
var add = setIPLocation(g);
loc.ip = this.intToIP(ip);
loc.Country = add.Country;
loc.Area = add.Area;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.searchIP" id="apidoc.element.neocrawler.qqwry.searchIP">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>searchIP
        <span class="apidocSignatureSpan">(IP)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchIP = function (IP){
    uninfo &#x26;&#x26; uninfo();
    var ip = this.ipToInt(IP),
        g = LocateIP(ip),
        loc={};
    if(g == -1){return {&#x22;ip&#x22;:IP,&#x22;Country&#x22;:unArea,&#x22;Area&#x22;:unCountry};}
    var add = setIPLocation(g);
    loc.ip = this.intToIP(ip);
    loc.Country = add.Country;
    loc.Area = add.Area;
    dbug &#x26;&#x26; log(loc);
    return loc;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            });
        }
    }
}
}

proxyRouter.prototype.ipInChina = function(ip){
var ipL = qqwry.<span class="apidocCodeKeywordSpan">searchIP</span>(ip);
var inChina = true;
if(ipL) {
    logger.debug(JSON.stringify(ipL));
    if (ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
        ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
        ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
        ipL[&#x27;Country&#x27;].startsWith(&#x27;&#x27;) ||
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.searchIPScope" id="apidoc.element.neocrawler.qqwry.searchIPScope">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>searchIPScope
        <span class="apidocSignatureSpan">(bginIP, endIP, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchIPScope = function (bginIP, endIP, callback){
    uninfo &#x26;&#x26; uninfo();
    var _ip1,_ip2,b_g,e_g,ips=[];
    try{_ip1 = this.ipToInt(bginIP);}catch(e){throw (&#x22;The bginIP is not normal! &#x3e;&#x3e; &#x22; + bginIP);}
    try{_ip2 = this.ipToInt(endIP);}catch(e){throw (&#x22;The endIP is not normal! &#x3e;&#x3e; &#x22; + endIP);}
    b_g = LocateIP(_ip1);
    e_g = LocateIP(_ip2);
    for(var i = b_g; i&#x3c;= e_g ; i+= IP_RECORD_LENGTH){
        var loc = {},add = setIPLocation(i);
        loc.begIP = this.intToIP(ipFileBuffer.readUInt32LE(i,true));
        loc.endIP = this.intToIP(ipFileBuffer.readUInt32LE(setBuffer3(i+4),true));
        loc.Country = add.Country;
        loc.Area = add.Area;
        ips.push(loc);
    }
    if(typeof callback === &#x22;function&#x22;){callback(ips);}
    return ips;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var o = this,args = arguments;
setTimeout(function(){o.info.apply(o,args)});
return this;
}

exports.searchIPScopeAsync = function(a,b,c){
var o = this;
setTimeout(function(){o.<span class="apidocCodeKeywordSpan">searchIPScope</span>(a,b,c)});
return this;
}

//
function setIPLocation(g){
var ipwz = setBuffer3(g+4) + 4;
var lx = ipFileBuffer.readUInt8(ipwz),
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.qqwry.searchIPScopeAsync" id="apidoc.element.neocrawler.qqwry.searchIPScopeAsync">
        function <span class="apidocSignatureSpan">neocrawler.qqwry.</span>searchIPScopeAsync
        <span class="apidocSignatureSpan">(a, b, c)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">searchIPScopeAsync = function (a, b, c){
    var o = this;
    setTimeout(function(){o.searchIPScope(a,b,c)});
    return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.routecontroller" id="apidoc.module.neocrawler.routecontroller">module neocrawler.routecontroller</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.routecontroller.mapRoute" id="apidoc.element.neocrawler.routecontroller.mapRoute">
        function <span class="apidocSignatureSpan">neocrawler.routecontroller.</span>mapRoute
        <span class="apidocSignatureSpan">(app)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">mapRoute = function (app) {
	//prefix = &#x27;/&#x27; + prefix;

	prefix_rule = &#x27;/rule&#x27;;
	prefix_proxy = &#x27;/proxy&#x27;;
    prefix_monitor = &#x27;/monitor&#x27;;

	var prefixRuleObj = require(&#x27;./controllers&#x27; + prefix_rule);
	var prefixProxyObj = require(&#x27;./controllers&#x27; + prefix_proxy);
    var prefixMonitorObj = require(&#x27;./controllers&#x27; + prefix_monitor);

	// index
	app.get(prefix_rule, prefixRuleObj.index);
	
	// search
	app.post(prefix_rule + &#x27;/search&#x27;, prefixRuleObj.search);	
	// add
	app.get(prefix_rule + &#x27;/new&#x27;, prefixRuleObj.new);
	// show
	app.get(prefix_rule + &#x27;/:id&#x27;, prefixRuleObj.show);
	// create
	app.post(prefix_rule + &#x27;/create&#x27;, prefixRuleObj.create);
	// edit
	app.get(prefix_rule + &#x27;/:id/edit&#x27;, prefixRuleObj.edit);
	// update
	app.post(prefix_rule + &#x27;/upsert&#x27;, prefixRuleObj.update);
	// destroy
	app.del(prefix_rule + &#x27;/:id&#x27;, prefixRuleObj.destroy);
	
/////////////////////////////////////////////////////////////////////
	// Proxy index
	app.get(prefix_proxy, prefixProxyObj.index);
	// Proxy index
	app.get(prefix_proxy + &#x27;/index&#x27;, prefixProxyObj.index);	
	// Proxy edit
	app.get(prefix_proxy + &#x22;/new&#x22;, prefixProxyObj.new);
	// Proxy create
	app.post(prefix_proxy + &#x22;/create&#x22;, prefixProxyObj.create);
	// Proxy destroy
	app.get(prefix_proxy + &#x22;/:host/:key&#x22;, prefixProxyObj.destroy);

/////////////////////////////////////////////////////////////////////////

    app.get(prefix_monitor + &#x22;/daily&#x22;, prefixMonitorObj.daily);
    app.get(prefix_monitor + &#x22;/linkdb&#x22;, prefixMonitorObj.linkdb);
    app.get(prefix_monitor + &#x22;/chart&#x22;, prefixMonitorObj.chart);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  		return (username == settings[&#x27;config_web_auth&#x27;][0] &#x26;&#x26; password == settings[&#x27;config_web_auth&#x27;][
1]);
	},&#x27;Restrict area, please identify&#x27;);	
	
	app.all(&#x22;*&#x22;, basicAuth);
	}

        app.get(&#x27;/&#x27;, routes.index);
	controller.<span class="apidocCodeKeywordSpan">mapRoute</span>(app);

	console.log(&#x27;create server.&#x27;);
	http.createServer(app).listen(app.get(&#x27;port&#x27;), function(){
		console.log(&#x27;webconfig server listening on port &#x27; + app.get(&#x27;port&#x27;));
	});
}
////////////////////////////////////////
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.scan" id="apidoc.module.neocrawler.scan">module neocrawler.scan</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.scan.Scan" id="apidoc.element.neocrawler.scan.Scan">
        function <span class="apidocSignatureSpan">neocrawler.scan.</span>Scan
        <span class="apidocSignatureSpan">(table, startRow, stopRow, client)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Scan(table, startRow, stopRow, client) {
  this.table = table;
  this.startRow = startRow;
  this.stopRow = stopRow;
  this.client = client;
  this.toArray = __bind(this.toArray, this);
  this.each = __bind(this.each, this);
  this.close = __bind(this.close, this);
  this.next = __bind(this.next, this);
  this.getServerAndLocation = __bind(this.getServerAndLocation, this);
  this._processResponse = __bind(this._processResponse, this);
  this._getData = __bind(this._getData, this);
  this.setFilter = __bind(this.setFilter, this);
  this.closed = false;
  this.numCached = 100;
  this.cached = [];
  this.server = null;
  this.location = null;
  this.timeout = null;
  this.row = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }
    if (_this.filter) {
      req.scan.filter = _this.filter;
    }
    _this.row++;
    region = _this.location.name.toString();
    debug(&#x22;scan on: &#x22; + _this.table + &#x22; row: &#x22; + _this.row + &#x22; region: &#x22; + region + &#x22; startRow
: &#x22; + _this.startRow + &#x22; stopRow: &#x22; + _this.stopRow);
    return _this.server.rpc.<span class="apidocCodeKeywordSpan">Scan</span>(req, function(err, response) {
      if (err) {
        return cb(err);
      }
      return _this._processResponse(response, cb);
    });
  };
})(this));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.scan.getFilter" id="apidoc.element.neocrawler.scan.getFilter">
        function <span class="apidocSignatureSpan">neocrawler.scan.</span>getFilter
        <span class="apidocSignatureSpan">(filter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFilter = function (filter) {
  var FilterList, filterList, filterName, filterNameUpper, o, serialized;
  FilterList = require(&#x27;./filter-list&#x27;);
  if (filter instanceof FilterList) {
    filterList = new proto.FilterList(filter.get());
    o = {
      name: &#x27;org.apache.hadoop.hbase.filter.FilterList&#x27;,
      serializedFilter: filterList.encode()
    };
    return o;
  }
  filterName = Object.keys(filter)[0];
  filterNameUpper = &#x22;&#x22; + (filterName[0].toUpperCase()) + filterName.slice(1);
  if (!proto[filterNameUpper]) {
    throw new Error(&#x22;Invalid filter &#x22; + filterNameUpper);
  }
  if (filterNameUpper === &#x27;SingleColumnValueFilter&#x27;) {
    filter[filterName].comparator = getFilter(filter[filterName].comparator);
  }
  o = {
    name: &#x22;org.apache.hadoop.hbase.filter.&#x22; + filterNameUpper
  };
  serialized = &#x27;serializedFilter&#x27;;
  if (filterNameUpper.indexOf(&#x27;Comparator&#x27;) &#x3e;= 0) {
    serialized = &#x27;serializedComparator&#x27;;
  }
  o[serialized] = new proto[filterNameUpper](filter[filterName]).encode();
  return o;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.spider" id="apidoc.module.neocrawler.spider">module neocrawler.spider</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.spider.spider" id="apidoc.element.neocrawler.spider.spider">
        function <span class="apidocSignatureSpan">neocrawler.</span>spider
        <span class="apidocSignatureSpan">(spiderCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">spider = function (spiderCore){
    this.spiderCore = spiderCore;
    this.queue_length = 0;
    this.driller_rules_updated = 0;
    this.driller_rules = {};
    logger = spiderCore.settings.logger;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.spider.prototype" id="apidoc.module.neocrawler.spider.prototype">module neocrawler.spider.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.__getTopLevelDomain" id="apidoc.element.neocrawler.spider.prototype.__getTopLevelDomain">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>__getTopLevelDomain
        <span class="apidocSignatureSpan">(domain)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">__getTopLevelDomain = function (domain){
    var arr = domain.split(&#x27;.&#x27;);
    if(arr.length&#x3c;=2)return domain;
    else return arr.slice(1).join(&#x27;.&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
proxyRouter.prototype.proxyDaemon = function(){
var proxyRouter = this;
var httpProxyServer = http.createServer(function(request, response) {
    var timeOuter = false;
    var startTime = (new Date()).getTime();
    var urlobj = url.parse(request.url);
    var domain = proxyRouter.<span class="apidocCodeKeywordSpan">__getTopLevelDomain</span>(urlobj[&#x27;hostname&#x27;]);
    logger.info(util.format(&#x27;Request %s from %s&#x27;,request.url,request.socket.remoteAddress));
    //var proxy = http.createClient(80, request.headers[&#x27;host&#x27;]);
    //var proxy_request = proxy.request(request.method, request.url, request.headers);//202.171.253.98:80
    var route = true;
    proxyRouter.__chooseProxy(domain,request.socket.remoteAddress,request.headers,function(proxyAddr){
        if(route&#x26;&#x26;proxyAddr){
            var choseProxy = proxyAddr.split(&#x27;:&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.assembly" id="apidoc.element.neocrawler.spider.prototype.assembly">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>assembly
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">assembly = function (callback){
    var self = this;
    var dbtype = &#x27;redis&#x27;;
    if(this.spiderCore.settings[&#x27;use_ssdb&#x27;])dbtype = &#x27;ssdb&#x27;;
    async.series([
        function(cb){
            myredis.createClient(
                self.spiderCore.settings[&#x27;driller_info_redis_db&#x27;][0],
                self.spiderCore.settings[&#x27;driller_info_redis_db&#x27;][1],
                self.spiderCore.settings[&#x27;driller_info_redis_db&#x27;][2],
                dbtype,
                function(err,cli){
                    self.redis_cli0 = cli;
                    cb(err);
                });
        },
        function(cb){
            myredis.createClient(
                self.spiderCore.settings[&#x27;url_info_redis_db&#x27;][0],
                self.spiderCore.settings[&#x27;url_info_redis_db&#x27;][1],
                self.spiderCore.settings[&#x27;url_info_redis_db&#x27;][2],
                dbtype,
                function(err,cli){
                    self.redis_cli1 = cli;
                    cb(err);
                });
        },
        function(cb){
            myredis.createClient(
                self.spiderCore.settings[&#x27;url_report_redis_db&#x27;][0],
                self.spiderCore.settings[&#x27;url_report_redis_db&#x27;][1],
                self.spiderCore.settings[&#x27;url_report_redis_db&#x27;][2],
                dbtype,
                function(err,cli){
                    self.redis_cli2 = cli;
                    cb(err);
                });
        }
    ],function(err,result){
        if(callback)callback(null,&#x27;done&#x27;);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.checkQueue" id="apidoc.element.neocrawler.spider.prototype.checkQueue">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>checkQueue
        <span class="apidocSignatureSpan">(spider)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkQueue = function (spider){
    var breakTt = false;
    async.whilst(
        function() {
            logger.debug(&#x27;Check queue, length: &#x27;+spider.queue_length);
            return spider.queue_length &#x3c; spider.spiderCore.settings[&#x27;spider_concurrency&#x27;] &#x26;&#x26; breakTt !== true;
        },
        function(cb) {
            spider.getUrlQueue(function(bol){
                if(bol===true)spider.queue_length++;
                else breakTt = true;
                cb();
            });
        },
        function(err) {
            if(err)logger.error(&#x27;Exception in check queue.&#x27;);
        }
    );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.detectLink" id="apidoc.element.neocrawler.spider.prototype.detectLink">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>detectLink
        <span class="apidocSignatureSpan">(link)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">detectLink = function (link){
    var urlobj = url.parse(link);
    var result = &#x27;&#x27;;
    var domain = this.__getTopLevelDomain(urlobj[&#x27;hostname&#x27;]);
    if(this.driller_rules[domain]!=undefined){
        var alias = this.driller_rules[domain];
        for(a in alias){
            if(alias.hasOwnProperty(a)){
                //var url_pattern  = decodeURIComponent(alias[a][&#x27;url_pattern&#x27;]);
                var url_pattern  = alias[a][&#x27;url_pattern&#x27;];
                var patt = new RegExp(url_pattern);
                if(patt.test(link)){
                    result = &#x27;driller:&#x27;+domain+&#x27;:&#x27;+a;
                    break;
                }
            }
        }
    }
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param links
 * @returns {{}}
 */
extractor.prototype.arrange_link = function(links){
var linkobj = {};
for(var i=0;i&#x3c;links.length;i++){
    var link = links[i];
    var matched_driller = this.<span class="apidocCodeKeywordSpan">detectLink</span>(link);
    if(matched_driller.length&#x3e;0){
        var driller_lib = &#x27;urllib:&#x27; + matched_driller[0];
        var driller_rule = matched_driller[1];
        if(typeof(driller_rule)!=&#x27;object&#x27;)driller_rule = JSON.parse(driller_rule);
        if(linkobj[driller_lib]==undefined)linkobj[driller_lib]=[];
        if(driller_rule[&#x27;id_parameter&#x27;]&#x26;&#x26;driller_rule[&#x27;id_parameter&#x27;].length&#x3e;0){
            var id_parameter = driller_rule[&#x27;id_parameter&#x27;];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.getDrillerRule" id="apidoc.element.neocrawler.spider.prototype.getDrillerRule">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>getDrillerRule
        <span class="apidocSignatureSpan">(id, name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDrillerRule = function (id, name){
    var splited_id = id.split(&#x27;:&#x27;);
    var pos = 1;
    if(splited_id[0]===&#x27;urllib&#x27;)pos = 2;
    if(this.driller_rules[splited_id[pos]][splited_id[pos+1]]&#x26;&#x26;this.driller_rules[splited_id[pos]][splited_id[pos+1]].hasOwnProperty
(name)){
        return this.driller_rules[splited_id[pos]][splited_id[pos+1]][name];
    }else{
        logger.warn(util.format(&#x27;%s in %s %s, not found&#x27;,name,splited_id[pos],splited_id[pos+1]));
        return false;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var timeOuter = false;
var pageLink = urlinfo[&#x27;url&#x27;];
if(urlinfo[&#x27;redirect&#x27;])pageLink = urlinfo[&#x27;redirect&#x27;];

var useProxy = false;
if(urlinfo[&#x27;urllib&#x27;]&#x26;&#x26;spiderCore.settings[&#x27;use_proxy&#x27;]===true){
    if(spiderCore.spider.<span class="apidocCodeKeywordSpan">getDrillerRule</span>(urlinfo[&#x27;urllib&#x27;],&#x27;use_proxy&#
x27;)===true)useProxy=true;
}

if(useProxy){
    var proxyRouter = spiderCore.settings[&#x27;proxy_router&#x27;].split(&#x27;:&#x27;);
    var __host = proxyRouter[0];
    var __port = proxyRouter[1];
    var __path =  pageLink;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.getDrillerRules" id="apidoc.element.neocrawler.spider.prototype.getDrillerRules">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>getDrillerRules
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getDrillerRules = function (id){
    var splited_id = id.split(&#x27;:&#x27;);
    var pos = 1;
    if(splited_id[0]===&#x27;urllib&#x27;)pos = 2;
    if(this.driller_rules[splited_id[pos]] &#x26;&#x26; this.driller_rules[splited_id[pos]][splited_id[pos+1]]){
        return this.driller_rules[splited_id[pos]][splited_id[pos+1]];
    }else{
        logger.warn(util.format(&#x27;%s%s, not exists&#x27;,splited_id[pos],splited_id[pos+1]));
        return null;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        spider.getUrlQueue(callback);
    }
}else{
    if(!link_info[&#x27;trace&#x27;]){
        logger.warn(link+&#x27;, url info is incomplete&#x27;);
        spider.getUrlQueue(callback);
    }else{
        var drillerinfo = spider.<span class="apidocCodeKeywordSpan">getDrillerRules</span>(link_info[&#x27;trace&#x27;]);
            if(drillerinfo==null){
                redis_urlinfo_db.del(linkhash,function(err){
                    logger.warn(link+&#x27;, has dirty driller info! clean it&#x27;);
                    var urlinfo = spider.wrapLink(link);
                    if(urlinfo!=null)spider.spiderCore.emit(&#x27;new_url_queue&#x27;,urlinfo);
                    else{
                        logger.error(&#x27;Cleaned dirty driller info for &#x27;+link+&#x27;, but can not match any driller rule
 right now, ignore it.&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.getUrlQueue" id="apidoc.element.neocrawler.spider.prototype.getUrlQueue">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>getUrlQueue
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getUrlQueue = function (callback){
    /*
     var urlinfo = {
     &#x22;url&#x22;:&#x22;http://list.taobao.com/itemlist/sport2011a.htm?spm=1.6659421.a21471u.6.RQYJRM&#x26;&#x26;md=5221&#x26;cat=50071853&#x26;sd=0&#x26;as=0&#x26;viewIndex
=1&#x26;atype=b&#x26;style=grid&#x26;same_info=1&#x26;tid=0&#x26;olu=yes&#x26;isnew=2&#x26;smc=1&#x26;navid=city&#x26;_input_charset=utf-8&#x22;,
     &#x22;type&#x22;:&#x22;branch&#x22;,
     &#x22;referer&#x22;:&#x22;http://www.taobao.com&#x22;,
     &#x22;cookie&#x22;:[],//require(&#x27;./taobao-cookie-simple.json&#x27;),
     &#x22;jshandle&#x22;:true,
     &#x22;inject_jquery&#x22;:false,
     &#x22;drill_rules&#x22;:[&#x22;.vm-page-next&#x22;,&#x22;.general a&#x22;,&#x22;a&#x22;],
     &#x22;script&#x22;:[&#x22;jsexec_result = document.getElementById(&#x27;pageJumpto&#x27;).value;&#x22;,&#x22;jsexec_result=document.querySelector(&#x27;.user-nick&#x27;).
text&#x22;],//[&#x22;jsexec_result = $.map($(&#x27;.category li a span&#x27;),function(n,i) {return $(n).text();});&#x22;],//[&#x22;jsexec_result=document.querySelector
(&#x27;.user-nick&#x27;).text;&#x22;]
     &#x22;navigate_rule&#x22;:[&#x22;.vm-page-next&#x22;],
     &#x22;stoppage&#x22;:3,
     &#x22;url_lib_id&#x22;:&#x22;urllib:driller:taobao.com:list&#x22;
     }
     */

    var spider = this;
    var redis_driller_db = this.redis_cli0;
    var redis_urlinfo_db = this.redis_cli1;
        redis_driller_db.lpop(&#x27;queue:scheduled:all&#x27;,function(err, link){
            //2----------------------------------------------------------------------------------------
            if(!link){
                logger.info(&#x27;No candidate queue, &#x27;+spider.queue_length+&#x27; urls in crawling.&#x27;);
                if(&#x27;no_queue_alert&#x27; in spider.spiderCore.spider_extend)spider.spiderCore.spider_extend.no_queue_alert();
                if(callback){callback(false);return;}
            };//no queue
                var linkhash = crypto.createHash(&#x27;md5&#x27;).update(link).digest(&#x27;hex&#x27;);
                redis_urlinfo_db.hgetall(linkhash,function(err, link_info){
                    //4---------------------------------------------------------------------------------
                    if(err)throw(err);
                    if(!link_info||isEmpty(link_info)){
                        logger.warn(link+&#x27; has no url info, &#x27;+linkhash+&#x27;, we try to match it&#x27;);
                        var urlinfo = spider.wrapLink(link);
                        if(urlinfo!=null)spider.spiderCore.emit(&#x27;new_url_queue&#x27;,urlinfo);
                        else{
                            logger.error(link+&#x27; can not match any driller rule, ignore it.&#x27;);
                            spider.getUrlQueue(callback);
                        }
                    }else{
                        if(!link_info[&#x27;trace&#x27;]){
                            logger.warn(link+&#x27;, url info is incomplete&#x27;);
                            spider.getUrlQueue(callback);
                        }else{
                            var drillerinfo = spider.getDrillerRules(link_info[&#x27;trace&#x27;]);
                                if(drillerinfo==null){
                                    redis_urlinfo_db.del(linkhash,function(err){
                                        logger.warn(link+&#x27;, has dirty driller info! clean it&#x27;);
                                        var urlinfo = spider.wrapLink(link);
                                        if(urlinfo!=null)spider.spiderCore.emit(&#x27;new_url_queue&#x27;,urlinfo);
                                        else{
                                            logger.error(&#x27;Cleaned dirty driller info for &#x27;+link+&#x27;, but can not match any driller
 rule right now, ignore it.&#x27;);
                                            spider.getUrlQueue(callback);
                                        }
                                    });
                                }else{
                                    var urlinfo = {
                                        &#x22;url&#x22;:link,
                                        &#x22;version&#x22;:parseInt(link_info[&#x27;version&#x27;]),
                                        &#x22;type&#x22;:drillerinfo[&#x27;type&#x27;],
                                        &#x22;format&#x22;:drillerinfo[&#x27;format&#x27;],
                                        &#x22;encoding&#x22;:drillerinfo[&#x27;encoding&#x27;],
                                        &#x22;referer&#x22;:link_info[&#x27;referer&#x27;],
                                        &#x22;url_pattern&#x22;:drillerinfo[&#x27;url_patt ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if(err)throw(err);
if(!link_info||isEmpty(link_info)){
    logger.warn(link+&#x27; has no url info, &#x27;+linkhash+&#x27;, we try to match it&#x27;);
    var urlinfo = spider.wrapLink(link);
    if(urlinfo!=null)spider.spiderCore.emit(&#x27;new_url_queue&#x27;,urlinfo);
    else{
        logger.error(link+&#x27; can not match any driller rule, ignore it.&#x27;);
        spider.<span class="apidocCodeKeywordSpan">getUrlQueue</span>(callback);
    }
}else{
    if(!link_info[&#x27;trace&#x27;]){
        logger.warn(link+&#x27;, url info is incomplete&#x27;);
        spider.getUrlQueue(callback);
    }else{
        var drillerinfo = spider.getDrillerRules(link_info[&#x27;trace&#x27;]);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.jsonSmartDeepParse" id="apidoc.element.neocrawler.spider.prototype.jsonSmartDeepParse">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>jsonSmartDeepParse
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">jsonSmartDeepParse = function (obj){
    var dataobj = {};
    var numberPattern = new RegExp(&#x22;^\-?[0-9]+$&#x22;);
    for(i in obj){
        if(obj.hasOwnProperty(i)){
            if(typeof(obj[i])===&#x27;string&#x27;&#x26;&#x26;(obj[i].charAt(0)===&#x27;{&#x27;||obj[i].charAt(0)===&#x27;[&#x27;)){
                dataobj[i] = JSON.parse(obj[i]);
            }else if(numberPattern.test(obj[i])){
                dataobj[i] = parseInt(obj[i]);
            }else if(obj[i]===&#x27;true&#x27;){
                dataobj[i] = true;
            }else if(obj[i]===&#x27;false&#x27;){
                dataobj[i] = false;
            }else dataobj[i] = obj[i];
        }
    }
    return dataobj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var redis_cli = this.redis_cli0;
redis_cli.hgetall(key, function(err,value){//for synchronized using object variable
    if(self.tmp_driller_rules==undefined)self.tmp_driller_rules = {};
    var isActive = value[&#x27;active&#x27;]==&#x27;true&#x27;||value[&#x27;active&#x27;]==true||value[&#x27;active&#x27;]==&#x27
;1&#x27;||value[&#x27;active&#x27;]==1?true:false;
    if(isActive||self.spiderCore.settings[&#x27;test&#x27;]) {
        logger.info(&#x27;Load rule: &#x27;+key);
        if (self.tmp_driller_rules[value[&#x27;domain&#x27;]] == undefined)self.tmp_driller_rules[value[&#x27;domain&#x27;]] = {};
        self.tmp_driller_rules[value[&#x27;domain&#x27;]][value[&#x27;alias&#x27;]] = self.<span class="apidocCodeKeywordSpan">jsonSmartDeepParse
</span>(value);
    }else logger.debug(&#x27;Ignore rule: &#x27;+key+&#x27;, status inactive&#x27;);
    self.tmp_driller_rules_length--;
    if(self.tmp_driller_rules_length&#x3c;=0){
        self.driller_rules = self.tmp_driller_rules;
        //self.driller_rules_updated = (new Date()).getTime();
        self.spiderCore.emit(&#x27;driller_rules_loaded&#x27;,self.driller_rules);
        setTimeout(function(){self.refreshDrillerRules();},self.spiderCore.settings[&#x27;check_driller_rules_interval&#x27;]*1000
);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.refreshDrillerRules" id="apidoc.element.neocrawler.spider.prototype.refreshDrillerRules">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>refreshDrillerRules
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">refreshDrillerRules = function (){
    var self = this;
    var redis_cli = this.redis_cli0;
        redis_cli.get(&#x27;updated:driller:rule&#x27;,function(err,value){
            if (err)throw(err);
            if(self.driller_rules_updated!==parseInt(value)){//driller is changed
                logger.info(&#x27;driller rules is changed&#x27;);
                redis_cli.hlist(&#x27;driller:*&#x27;,function(err,values){
                    if (err)throw(err);
                    self.tmp_driller_rules = {};
                    self.tmp_driller_rules_length = values.length;
                    for(var i=0;i&#x3c;values.length;i++){
                        self.wrapper_rules(values[i]);
                    }
                });
                self.driller_rules_updated=parseInt(value);
            }else{
                logger.debug(&#x27;driller rules is not changed, queue length: &#x27;+self.queue_length);
                setTimeout(function(){self.refreshDrillerRules();},self.spiderCore.settings[&#x27;check_driller_rules_interval&#x27;]*1000
);
            }
        })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                for(var i=0;i&#x3c;values.length;i++){
                    self.wrapper_rules(values[i]);
                }
            });
            self.driller_rules_updated=parseInt(value);
        }else{
            logger.debug(&#x27;driller rules is not changed, queue length: &#x27;+self.queue_length);
            setTimeout(function(){self.<span class="apidocCodeKeywordSpan">refreshDrillerRules</span>();},self.spiderCore.settings
[&#x27;check_driller_rules_interval&#x27;]*1000);
        }
    })
}
//wrapper each rule
spider.prototype.wrapper_rules = function(key){
var self = this;
var redis_cli = this.redis_cli0;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.retryCrawl" id="apidoc.element.neocrawler.spider.prototype.retryCrawl">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>retryCrawl
        <span class="apidocSignatureSpan">(urlinfo)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">retryCrawl = function (urlinfo){
    var spider = this;
    var retryLimit = 3;
    if(spider.spiderCore.settings[&#x27;download_retry&#x27;]&#x26;&#x26;spider.spiderCore.settings[&#x27;download_retry&#x27;]!=undefined){
        retryLimit = spider.spiderCore.settings[&#x27;download_retry&#x27;];
    }
    var act_retry = 0;
    if(urlinfo[&#x27;retry&#x27;])act_retry = urlinfo[&#x27;retry&#x27;];

    if(act_retry&#x3c;retryLimit){
        urlinfo[&#x27;retry&#x27;] = act_retry+1;
        logger.info(util.format(&#x27;Retry url: %s, time: &#x27;,urlinfo[&#x27;url&#x27;],urlinfo[&#x27;retry&#x27;]));
        spider.spiderCore.emit(&#x27;new_url_queue&#x27;,urlinfo);
        if(&#x27;crawl_retry_alert&#x27; in spider.spiderCore.spider_extend)spider.spiderCore.spider_extend.crawl_retry_alert(urlinfo);//report
    }else{
        spider.updateLinkState(urlinfo[&#x27;url&#x27;],&#x27;crawled_failure&#x27;);
        logger.error(util.format(&#x27;after %s reties, give up crawl %s&#x27;,urlinfo[&#x27;retry&#x27;],urlinfo[&#x27;url&#x27;]));
        spider.redis_cli2.zadd(&#x27;fail:&#x27;+urlinfo[&#x27;urllib&#x27;],urlinfo[&#x27;version&#x27;],urlinfo[&#x27;url&#x27;],function(err,result){
            spider.spiderCore.emit(&#x27;slide_queue&#x27;);
        });
        if(&#x27;crawl_fail_alert&#x27; in spider.spiderCore.spider_extend)spider.spiderCore.spider_extend.crawl_fail_alert(urlinfo);//report
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.updateLinkState" id="apidoc.element.neocrawler.spider.prototype.updateLinkState">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>updateLinkState
        <span class="apidocSignatureSpan">(link, state, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">updateLinkState = function (link, state, callback){
    var spider = this;
    var urlhash = crypto.createHash(&#x27;md5&#x27;).update(link+&#x27;&#x27;).digest(&#x27;hex&#x27;);
    this.redis_cli1.hgetall(urlhash,function(err,link_info){
        if(err){
            logger.error(&#x27;get state of link(&#x27;+link+&#x27;) fail: &#x27;+err);
            if(callback)callback(err);
            return;
        }
        if(link_info&#x26;&#x26;!isEmpty(link_info)){
            var t_record = link_info[&#x27;records&#x27;];
            var records = [];
            if(t_record!=&#x27;&#x27;&#x26;&#x26;t_record!=&#x27;[]&#x27;){
                try{
                    records = JSON.parse(t_record);
                }catch(e){
                    logger.error(t_record+&#x27; JSON parse error: &#x27;+e);
                }
            }
            records.push(state);
            async.parallel([
                    function(cb){
                        spider.redis_cli1.hmset(urlhash,{&#x27;records&#x27;:JSON.stringify(records.length&#x3e;3?records.slice(-3):records),&#x27;last
&#x27;:(new Date()).getTime(),&#x27;status&#x27;:state},function(err,link_info){
                            if(err)logger.error(&#x27;update state of link(&#x27;+link+&#x27;) fail: &#x27;+err);
                            else logger.debug(&#x27;update state of link(&#x27;+link+&#x27;) success: &#x27;+state);
                            cb(err);
                        });
                    },
                    function(cb){
                        if(state==&#x27;crawled_finish&#x27;){
                            spider.redis_cli2.zrem(&#x27;fail:&#x27;+link_info[&#x27;trace&#x27;],link,function(err,result){
                                logger.debug(&#x27;remove &#x27;+link+&#x27; from fail:&#x27;+link_info[&#x27;trace&#x27;]);
                                cb(err);
                            });
                        }else cb(null);
                    }
                ],
                function(err, results){
                    if(callback)callback(err);
                });
        }else{
            var trace = spider.detectLink(link);
            if(trace!=&#x27;&#x27;){
                trace = &#x27;urllib:&#x27; + trace;
                var urlinfo = {
                    &#x27;url&#x27;:link,
                    &#x27;trace&#x27;:trace,
                    &#x27;referer&#x27;:&#x27;&#x27;,
                    &#x27;create&#x27;:(new Date()).getTime(),
                    &#x27;records&#x27;:JSON.stringify([]),
                    &#x27;last&#x27;:(new Date()).getTime(),
                    &#x27;status&#x27;:state
                }

                async.parallel([
                        function(cb){
                            spider.redis_cli1.hmset(urlhash,urlinfo,function(err, value){
                                if (err) throw(err);
                                logger.debug(&#x27;save new url info: &#x27;+link);
                                cb(err);
                            });
                        },
                        function(cb){
                            if(state===&#x27;crawled_finish&#x27;){
                                spider.redis_cli2.zrem(&#x27;fail:&#x27;+urlinfo[&#x27;trace&#x27;],link,function(err,result){
                                    logger.debug(&#x27;remove &#x27;+link+&#x27; from fail:&#x27;+urlinfo[&#x27;trace&#x27;]);
                                    cb(err);
                                });
                            }else cb(null);
                        }
                    ],
                    function(err, results){
                        if(callback)callback(err);
                    });
            }else {
                logger.error(link+&#x27; can not match any rules, ignore updating.&#x27;);
                if(callback)callback(err);
            }
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    if(act_retry&#x3c;retryLimit){
        urlinfo[&#x27;retry&#x27;] = act_retry+1;
        logger.info(util.format(&#x27;Retry url: %s, time: &#x27;,urlinfo[&#x27;url&#x27;],urlinfo[&#x27;retry&#x27;]));
        spider.spiderCore.emit(&#x27;new_url_queue&#x27;,urlinfo);
        if(&#x27;crawl_retry_alert&#x27; in spider.spiderCore.spider_extend)spider.spiderCore.spider_extend.crawl_retry_alert(urlinfo
);//report
    }else{
        spider.<span class="apidocCodeKeywordSpan">updateLinkState</span>(urlinfo[&#x27;url&#x27;],&#x27;crawled_failure&#x27;);
        logger.error(util.format(&#x27;after %s reties, give up crawl %s&#x27;,urlinfo[&#x27;retry&#x27;],urlinfo[&#x27;url&#x27
;]));
        spider.redis_cli2.zadd(&#x27;fail:&#x27;+urlinfo[&#x27;urllib&#x27;],urlinfo[&#x27;version&#x27;],urlinfo[&#x27;url&#x27
;],function(err,result){
            spider.spiderCore.emit(&#x27;slide_queue&#x27;);
        });
        if(&#x27;crawl_fail_alert&#x27; in spider.spiderCore.spider_extend)spider.spiderCore.spider_extend.crawl_fail_alert(urlinfo
);//report
    }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.wrapLink" id="apidoc.element.neocrawler.spider.prototype.wrapLink">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>wrapLink
        <span class="apidocSignatureSpan">(link)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapLink = function (link){
    var linkinfo = null;
    var driller = this.detectLink(link);
    if(driller!=&#x27;&#x27;){
        var driller_arr = driller.split(&#x27;:&#x27;);
        var drillerinfo = this.driller_rules[driller_arr[1]][driller_arr[2]];
        linkinfo = {
            &#x22;url&#x22;:link,
            &#x22;version&#x22;:(new Date()).getTime(),
            &#x22;type&#x22;:drillerinfo[&#x27;type&#x27;],
            &#x22;format&#x22;:drillerinfo[&#x27;format&#x27;],
            &#x22;encoding&#x22;:drillerinfo[&#x27;encoding&#x27;],
            &#x22;referer&#x22;:&#x22;&#x22;,
            &#x22;url_pattern&#x22;:drillerinfo[&#x27;url_pattern&#x27;],
            &#x22;urllib&#x22;:&#x27;urllib:&#x27;+driller,
            &#x22;save_page&#x22;:drillerinfo[&#x27;save_page&#x27;],
            &#x22;cookie&#x22;:drillerinfo[&#x27;cookie&#x27;],
            &#x22;jshandle&#x22;:drillerinfo[&#x27;jshandle&#x27;],
            &#x22;inject_jquery&#x22;:drillerinfo[&#x27;inject_jquery&#x27;],
            &#x22;drill_rules&#x22;:drillerinfo[&#x27;drill_rules&#x27;],
            &#x22;drill_relation&#x22;:&#x27;*&#x27;,
            &#x22;validation_keywords&#x22;:drillerinfo[&#x27;validation_keywords&#x27;]&#x26;&#x26;drillerinfo[&#x27;validation_keywords&#x27;]!=&#x27;undefined&#x27;?drillerinfo
[&#x27;validation_keywords&#x27;]:&#x27;&#x27;,
            &#x22;script&#x22;:drillerinfo[&#x27;script&#x27;],
            &#x22;navigate_rule&#x22;:drillerinfo[&#x27;navigate_rule&#x27;],
            &#x22;stoppage&#x22;:drillerinfo[&#x27;stoppage&#x27;]
        }
    }
    return linkinfo;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            };//no queue
var linkhash = crypto.createHash(&#x27;md5&#x27;).update(link).digest(&#x27;hex&#x27;);
redis_urlinfo_db.hgetall(linkhash,function(err, link_info){
    //4---------------------------------------------------------------------------------
    if(err)throw(err);
    if(!link_info||isEmpty(link_info)){
        logger.warn(link+&#x27; has no url info, &#x27;+linkhash+&#x27;, we try to match it&#x27;);
        var urlinfo = spider.<span class="apidocCodeKeywordSpan">wrapLink</span>(link);
        if(urlinfo!=null)spider.spiderCore.emit(&#x27;new_url_queue&#x27;,urlinfo);
        else{
            logger.error(link+&#x27; can not match any driller rule, ignore it.&#x27;);
            spider.getUrlQueue(callback);
        }
    }else{
        if(!link_info[&#x27;trace&#x27;]){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.spider.prototype.wrapper_rules" id="apidoc.element.neocrawler.spider.prototype.wrapper_rules">
        function <span class="apidocSignatureSpan">neocrawler.spider.prototype.</span>wrapper_rules
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapper_rules = function (key){
    var self = this;
    var redis_cli = this.redis_cli0;
    redis_cli.hgetall(key, function(err,value){//for synchronized using object variable
        if(self.tmp_driller_rules==undefined)self.tmp_driller_rules = {};
        var isActive = value[&#x27;active&#x27;]==&#x27;true&#x27;||value[&#x27;active&#x27;]==true||value[&#x27;active&#x27;]==&#x27;1&#x27;||value[&#x27;active&#x27;]==1?true:false;
        if(isActive||self.spiderCore.settings[&#x27;test&#x27;]) {
            logger.info(&#x27;Load rule: &#x27;+key);
            if (self.tmp_driller_rules[value[&#x27;domain&#x27;]] == undefined)self.tmp_driller_rules[value[&#x27;domain&#x27;]] = {};
            self.tmp_driller_rules[value[&#x27;domain&#x27;]][value[&#x27;alias&#x27;]] = self.jsonSmartDeepParse(value);
        }else logger.debug(&#x27;Ignore rule: &#x27;+key+&#x27;, status inactive&#x27;);
        self.tmp_driller_rules_length--;
        if(self.tmp_driller_rules_length&#x3c;=0){
            self.driller_rules = self.tmp_driller_rules;
            //self.driller_rules_updated = (new Date()).getTime();
            self.spiderCore.emit(&#x27;driller_rules_loaded&#x27;,self.driller_rules);
            setTimeout(function(){self.refreshDrillerRules();},self.spiderCore.settings[&#x27;check_driller_rules_interval&#x27;]*1000);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if(self.driller_rules_updated!==parseInt(value)){//driller is changed
    logger.info(&#x27;driller rules is changed&#x27;);
    redis_cli.hlist(&#x27;driller:*&#x27;,function(err,values){
        if (err)throw(err);
        self.tmp_driller_rules = {};
        self.tmp_driller_rules_length = values.length;
        for(var i=0;i&#x3c;values.length;i++){
            self.<span class="apidocCodeKeywordSpan">wrapper_rules</span>(values[i]);
        }
    });
    self.driller_rules_updated=parseInt(value);
}else{
    logger.debug(&#x27;driller rules is not changed, queue length: &#x27;+self.queue_length);
    setTimeout(function(){self.refreshDrillerRules();},self.spiderCore.settings[&#x27;check_driller_rules_interval&#x27;]*1000);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.ssdb_redis" id="apidoc.module.neocrawler.ssdb_redis">module neocrawler.ssdb_redis</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.ssdb_redis.client" id="apidoc.element.neocrawler.ssdb_redis.client">
        function <span class="apidocSignatureSpan">neocrawler.ssdb_redis.</span>client
        <span class="apidocSignatureSpan">(host, port)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">client = function (host, port){
    return new redis_cli(host,port);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */

var redis = require(&#x22;redis&#x22;);
var ssdb = require(&#x22;./ssdb_redis.js&#x22;);

exports.createClient = function(host,port,db,type,callback){
if(type==&#x27;ssdb&#x27;){
    var ssdb_cli = ssdb.<span class="apidocCodeKeywordSpan">client</span>(host,port);
    callback(null,ssdb_cli);
}else{
    var redis_cli = redis.createClient(port,host);
    redis_cli.hlist = function(name,callback){
        redis_cli.keys(name,callback);
    };
    redis_cli.hclear = function(name,callback){
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.utils" id="apidoc.module.neocrawler.utils">module neocrawler.utils</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.utils.bufferCompare" id="apidoc.element.neocrawler.utils.bufferCompare">
        function <span class="apidocSignatureSpan">neocrawler.utils.</span>bufferCompare
        <span class="apidocSignatureSpan">(a, b)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">bufferCompare = function (a, b) {
  var i, len1, len2, _a, _b, _i, _ref;
  len1 = a.length;
  len2 = b.length;
  if (a === b &#x26;&#x26; len1 === len2) {
    return 0;
  }
  for (i = _i = 0, _ref = len1 - 1; 0 &#x3c;= _ref ? _i &#x3c;= _ref : _i &#x3e;= _ref; i = 0 &#x3c;= _ref ? ++_i : --_i) {
    if (a[i] !== b[i]) {
      _a = a[i] ? a[i] : 0;
      _b = b[i] ? b[i] : 0;
      return _a - _b;
    }
  }
  return len1 - len2;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
len = response.results.length;
if (len === this.numCached) {
  nextRegion = false;
}
if (this.location.endKey.length === 0) {
  nextRegion = false;
}
if (this.stopRow &#x26;&#x26; utils.<span class="apidocCodeKeywordSpan">bufferCompare</span>(this.location.endKey, new Buffer(this
.stopRow)) &#x3e; 0 &#x26;&#x26; len !== this.numCached) {
  nextRegion = false;
}
if (len &#x3c; this.numCached) {
  this.nextStartRow = utils.bufferIncrement(this.location.endKey);
  this.nextStartRow = this.nextStartRow.toString();
}
if (nextRegion) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.neocrawler.utils.bufferIncrement" id="apidoc.element.neocrawler.utils.bufferIncrement">
        function <span class="apidocSignatureSpan">neocrawler.utils.</span>bufferIncrement
        <span class="apidocSignatureSpan">(buffer, i)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">bufferIncrement = function (buffer, i) {
  var b, newBuffer, tmp;
  b = new Buffer(buffer);
  if (i == null) {
    i = b.length - 1;
  }
  if (i &#x3c; 0) {
    return Buffer.concat([new Buffer([1]), b]);
  }
  tmp = new Buffer([parseInt(b[i]++)]);
  if (tmp[0] &#x3e; b[i]) {
    newBuffer = _this.bufferIncrement(b, i - 1);
  }
  if (newBuffer &#x26;&#x26; b.length &#x3c; newBuffer.length) {
    return newBuffer;
  }
  return b;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (this.location.endKey.length === 0) {
  nextRegion = false;
}
if (this.stopRow &#x26;&#x26; utils.bufferCompare(this.location.endKey, new Buffer(this.stopRow)) &#x3e; 0 &#x26;&#x26; len !==
this.numCached) {
  nextRegion = false;
}
if (len &#x3c; this.numCached) {
  this.nextStartRow = utils.<span class="apidocCodeKeywordSpan">bufferIncrement</span>(this.location.endKey);
  this.nextStartRow = this.nextStartRow.toString();
}
if (nextRegion) {
  this.closeScan(this.server, this.location, this.scannerId);
  this.server = this.location = this.scannerId = null;
  if (len === 0) {
    return this._getData(this.nextStartRow, cb);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.webconfig" id="apidoc.module.neocrawler.webconfig">module neocrawler.webconfig</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.webconfig.webconfig" id="apidoc.element.neocrawler.webconfig.webconfig">
        function <span class="apidocSignatureSpan">neocrawler.</span>webconfig
        <span class="apidocSignatureSpan">(webconfigCore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">webconfig = function (webconfigCore){
	events.EventEmitter.call(this);
	this.webconfigCore = webconfigCore;
	logger = webconfigCore.settings.logger;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.neocrawler.webconfig.prototype" id="apidoc.module.neocrawler.webconfig.prototype">module neocrawler.webconfig.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.neocrawler.webconfig.prototype.launch" id="apidoc.element.neocrawler.webconfig.prototype.launch">
        function <span class="apidocSignatureSpan">neocrawler.webconfig.prototype.</span>launch
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">launch = function (settings){

	var app = express();
	// all environments
	app.set(&#x27;port&#x27;, settings[&#x27;port&#x27;]);


	app.configure(function(){
	  app.set(&#x27;views&#x27;, __dirname + &#x27;/views&#x27;);
	  app.set(&#x27;view engine&#x27;, &#x27;ejs&#x27;);
	  app.use(express.favicon());
//	  app.use(express.logger(&#x27;dev&#x27;));
	  //
      app.use(express.cookieParser());
	  app.use(express.session({secret: &#x27;1234567890QWERTY&#x27;}));
 	  //
	  app.use(express.urlencoded());
	  app.use(express.staticCache({maxObjects: 100, maxLength: 512}));
	  app.use(stylus.middleware({
		src: __dirname + &#x27;/views&#x27;
		, dest: __dirname + &#x27;/public&#x27;
		}));
	  app.use(express.static(__dirname + &#x27;/public&#x27;));
	  app.use(express.bodyParser());
	  app.use(express.methodOverride());
	  app.use(app.router);
	  app.use(express.directory(__dirname + &#x27;/public&#x27;));
	  app.use(function(req, res, next){
	    throw new Error(req.url + &#x27; not found&#x27;);
	  });
	  app.use(function(err, req, res, next) {
	    if(err)console.error(err);
	    res.send(err.message);
	  });
	});
	// development only
	if (&#x27;development&#x27; == app.get(&#x27;env&#x27;)) {
		app.use(express.errorHandler());
	}
	
        // Authenticator
        //app.use(express.basicAuth(&#x27;config&#x27;,&#x27;config123&#x27;));//for 2.x
	if(settings[&#x27;config_web_auth&#x27;]){
	var basicAuth = express.basicAuth(function(username, password) {
  		return (username == settings[&#x27;config_web_auth&#x27;][0] &#x26;&#x26; password == settings[&#x27;config_web_auth&#x27;][1]);
	},&#x27;Restrict area, please identify&#x27;);	
	
	app.all(&#x22;*&#x22;, basicAuth);
	}

        app.get(&#x27;/&#x27;, routes.index);
	controller.mapRoute(app);

	console.log(&#x27;create server.&#x27;);
	http.createServer(app).listen(app.get(&#x27;port&#x27;), function(){
		console.log(&#x27;webconfig server listening on port &#x27; + app.get(&#x27;port&#x27;));
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
